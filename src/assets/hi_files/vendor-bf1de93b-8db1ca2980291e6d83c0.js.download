try{let t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},e=(new t.Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="7ca06023-105f-428c-a09a-655ee20939e8",t._sentryDebugIdIdentifier="sentry-dbid-7ca06023-105f-428c-a09a-655ee20939e8")}catch(t){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"c0ef53c"},(self.webpackChunk_loomhq_web_client=self.webpackChunk_loomhq_web_client||[]).push([[1886],{18268:function(t,e,i){"use strict";i.r(e);var n=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function a(t,e){if(t.length!==e.length)return!1;for(var i,a,r=0;r<t.length;r++)if(!((i=t[r])===(a=e[r])||n(i)&&n(a)))return!1;return!0}e.default=function(t,e){void 0===e&&(e=a);var i,n,r=[],s=!1;return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];return s&&i===this&&e(a,r)||(n=t.apply(this,a),s=!0,i=this,r=a),n}}},95007:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});var n=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function a(t,e){if(t.length!==e.length)return!1;for(var i,a,r=0;r<t.length;r++)if(!((i=t[r])===(a=e[r])||n(i)&&n(a)))return!1;return!0}function r(t,e){void 0===e&&(e=a);var i=null;function n(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(i&&i.lastThis===this&&e(n,i.lastArgs))return i.lastResult;var r=t.apply(this,n);return i={lastResult:r,lastArgs:n,lastThis:this},r}return n.clear=function(){i=null},n}},87755:function(t,e,i){var n=i(9904),a=/[\/\+\.]/;t.exports=function(t,e){function i(e){var i=n(e,t,a);return i&&i.length>=2}return e?i(e.split(";")[0]):i}},93888:function(t,e,i){"use strict";var n=i(66420),a=i(42625),r=i(96536),s=i.n(r),o="u">typeof globalThis?globalThis:"u">typeof window?window:"u">typeof i.g?i.g:{},d=n.createContext||function(t,e){var i,r,d,h="__create-react-context-"+(o[i="__global_unique_id__"]=(o[i]||0)+1)+"__",p=function(t){function i(){var e,i,n;return e=t.apply(this,arguments)||this,e.emitter=(i=e.props.value,n=[],{on:function(t){n.push(t)},off:function(t){n=n.filter(function(e){return e!==t})},get:function(){return i},set:function(t,e){i=t,n.forEach(function(t){return t(i,e)})}}),e}(0,a.Z)(i,t);var n=i.prototype;return n.getChildContext=function(){var t;return(t={})[h]=this.emitter,t},n.componentWillReceiveProps=function(t){if(this.props.value!==t.value){var i,n=this.props.value,a=t.value;(n===a?0!==n||1/n==1/a:n!=n&&a!=a)?i=0:0!=(i=("function"==typeof e?e(n,a):1073741823)|0)&&this.emitter.set(t.value,i)}},n.render=function(){return this.props.children},i}(n.Component);p.childContextTypes=((r={})[h]=s().object.isRequired,r);var u=function(e){function i(){var t;return t=e.apply(this,arguments)||this,t.state={value:t.getValue()},t.onUpdate=function(e,i){(0|t.observedBits)&i&&t.setState({value:t.getValue()})},t}(0,a.Z)(i,e);var n=i.prototype;return n.componentWillReceiveProps=function(t){var e=t.observedBits;this.observedBits=e??1073741823},n.componentDidMount=function(){this.context[h]&&this.context[h].on(this.onUpdate);var t=this.props.observedBits;this.observedBits=t??1073741823},n.componentWillUnmount=function(){this.context[h]&&this.context[h].off(this.onUpdate)},n.getValue=function(){return this.context[h]?this.context[h].get():t},n.render=function(){var t;return(Array.isArray(t=this.props.children)?t[0]:t)(this.state.value)},i}(n.Component);return u.contextTypes=((d={})[h]=s().object,d),{Provider:p,Consumer:u}};e.Z=d},38760:function(t,e,i){var n;!function(a,r,s){if(a){for(var o,d={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},h={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},p={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},l=1;l<20;++l)d[111+l]="f"+l;for(l=0;l<=9;++l)d[l+96]=l.toString();y.prototype.bind=function(t,e,i){return t=t instanceof Array?t:[t],this._bindMultiple.call(this,t,e,i),this},y.prototype.unbind=function(t,e){return this.bind.call(this,t,function(){},e)},y.prototype.trigger=function(t,e){return this._directMap[t+":"+e]&&this._directMap[t+":"+e]({},t),this},y.prototype.reset=function(){return this._callbacks={},this._directMap={},this},y.prototype.stopCallback=function(t,e){if((" "+e.className+" ").indexOf(" mousetrap ")>-1||function t(e,i){return null!==e&&e!==r&&(e===i||t(e.parentNode,i))}(e,this.target))return!1;if("composedPath"in t&&"function"==typeof t.composedPath){var i=t.composedPath()[0];i!==t.target&&(e=i)}return"INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable},y.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},y.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(d[e]=t[e]);o=null},y.init=function(){var t=y(r);for(var e in t)"_"!==e.charAt(0)&&(y[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},y.init(),a.Mousetrap=y,t.exports&&(t.exports=y),void 0!==(n=(function(){return y}).call(e,i,e,t))&&(t.exports=n)}function c(t,e,i){if(t.addEventListener){t.addEventListener(e,i,!1);return}t.attachEvent("on"+e,i)}function f(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return d[t.which]?d[t.which]:h[t.which]?h[t.which]:String.fromCharCode(t.which).toLowerCase()}function m(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function g(t,e){var i,n,a,r,s,h,l=[];for(r="+"===(i=t)?["+"]:(i=i.replace(/\+{2}/g,"+plus")).split("+"),h=0;h<r.length;++h)u[s=r[h]]&&(s=u[s]),e&&"keypress"!=e&&p[s]&&(s=p[s],l.push("shift")),m(s)&&l.push(s);return n=s,(a=e)||(a=function(){if(!o)for(var t in o={},d)t>95&&t<112||d.hasOwnProperty(t)&&(o[d[t]]=t);return o}()[n]?"keydown":"keypress"),"keypress"==a&&l.length&&(a="keydown"),{key:s,modifiers:l,action:e=a}}function y(t){var e=this;if(t=t||r,!(e instanceof y))return new y(t);e.target=t,e._callbacks={},e._directMap={};var i,n={},a=!1,s=!1,o=!1;function d(t){t=t||{};var e,i=!1;for(e in n){if(t[e]){i=!0;continue}n[e]=0}i||(o=!1)}function h(t,i,a,r,s,o){var d,h,p,u,l=[],c=a.type;if(!e._callbacks[t])return[];for("keyup"==c&&m(t)&&(i=[t]),p=0;p<e._callbacks[t].length;++p)if(u=e._callbacks[t][p],!(!r&&u.seq&&n[u.seq]!=u.level)&&c==u.action&&("keypress"==c&&!a.metaKey&&!a.ctrlKey||(d=i,h=u.modifiers,d.sort().join(",")===h.sort().join(",")))){var f=!r&&u.combo==s,g=r&&u.seq==r&&u.level==o;(f||g)&&e._callbacks[t].splice(p,1),l.push(u)}return l}function p(t,i,n,a){e.stopCallback(i,i.target||i.srcElement,n,a)||!1===t(i,n)&&(function(t){if(t.preventDefault){t.preventDefault();return}t.returnValue=!1}(i),function(t){if(t.stopPropagation){t.stopPropagation();return}t.cancelBubble=!0}(i))}function u(t){"number"!=typeof t.which&&(t.which=t.keyCode);var i,n=f(t);if(n){if("keyup"==t.type&&a===n){a=!1;return}e.handleKey(n,(i=[],t.shiftKey&&i.push("shift"),t.altKey&&i.push("alt"),t.ctrlKey&&i.push("ctrl"),t.metaKey&&i.push("meta"),i),t)}}e._handleKey=function(t,e,i){var n,a=h(t,e,i),r={},u=0,l=!1;for(n=0;n<a.length;++n)a[n].seq&&(u=Math.max(u,a[n].level));for(n=0;n<a.length;++n){if(a[n].seq){if(a[n].level!=u)continue;l=!0,r[a[n].seq]=1,p(a[n].callback,i,a[n].combo,a[n].seq);continue}l||p(a[n].callback,i,a[n].combo)}var c="keypress"==i.type&&s;i.type!=o||m(t)||c||d(r),s=l&&"keydown"==i.type},e._bindMultiple=function(t,r,s){for(var u=0;u<t.length;++u)(function t(r,s,u,l,c){e._directMap[r+":"+u]=s;var m,y=(r=r.replace(/\s+/g," ")).split(" ");if(y.length>1){!function(e,r,s,h){function u(t){p(s,t,e),"keyup"!==h&&(a=f(t)),setTimeout(d,10)}n[e]=0;for(var l=0;l<r.length;++l){var c=l+1===r.length?u:function(t){return function(){o=t,++n[e],clearTimeout(i),i=setTimeout(d,1e3)}}(h||g(r[l+1]).action);t(r[l],c,h,e,l)}}(r,y,s,u);return}m=g(r,u),e._callbacks[m.key]=e._callbacks[m.key]||[],h(m.key,m.modifiers,{type:m.action},l,r,c),e._callbacks[m.key][l?"unshift":"push"]({callback:s,modifiers:m.modifiers,action:m.action,seq:l,level:c,combo:r})})(t[u],r,s)},c(t,"keypress",u),c(t,"keydown",u),c(t,"keyup",u)}}("u">typeof window?window:null,"u">typeof window?document:null)},60771:function(t,e,i){var n=i(16585);t.exports=function(t){"use strict";var e=t&&"object"==typeof t&&"default"in t?t:{default:t},i=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e]=t[e].concat(i)},this.off=function(e,i){var n;return!!t[e]&&(n=t[e].indexOf(i),t[e]=t[e].slice(),t[e].splice(n,1),n>-1)},this.trigger=function(e){var i,n,a,r;if(i=t[e]){if(2==arguments.length)for(a=i.length,n=0;n<a;++n)i[n].call(this,arguments[1]);else{for(r=[],n=arguments.length,n=1;n<arguments.length;++n)r.push(arguments[n]);for(a=i.length,n=0;n<a;++n)i[n].apply(this,r)}}},this.dispose=function(){t={}}}};i.prototype.pipe=function(t){return this.on("data",function(e){t.push(e)}),this.on("done",function(e){t.flush(e)}),this.on("partialdone",function(e){t.partialFlush(e)}),this.on("endedtimeline",function(e){t.endTimeline(e)}),this.on("reset",function(e){t.reset(e)}),t},i.prototype.push=function(t){this.trigger("data",t)},i.prototype.flush=function(t){this.trigger("done",t)},i.prototype.partialFlush=function(t){this.trigger("partialdone",t)},i.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},i.prototype.reset=function(t){this.trigger("reset",t)},a=function(t){return 9e4*t};var a,r,s,o,d,h={ONE_SECOND_IN_TS:9e4,secondsToVideoTs:a,secondsToAudioTs:r=function(t,e){return t*e},videoTsToSeconds:s=function(t){return t/9e4},audioTsToSeconds:o=function(t,e){return t/e},audioTsToVideoTs:function(t,e){return a(o(t,e))},videoTsToAudioTs:function(t,e){return r(s(t),e)},metadataTsToSeconds:function(t,e,i){return s(i?t:t-e)}},p=h.ONE_SECOND_IN_TS,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(d=function(t){var e,i=0;d.prototype.init.call(this),this.skipWarn_=function(t,e){this.trigger("log",{level:"warn",message:"adts skiping bytes "+t+" to "+e+" in frame "+i+" outside syncword"})},this.push=function(n){var a,r,s,o,d,h,l=0;if(t||(i=0),"audio"===n.type){for(e&&e.length?(o=e,(e=new Uint8Array(o.byteLength+n.data.byteLength)).set(o),e.set(n.data,o.byteLength)):e=n.data;l+7<e.length;){if(255!==e[l]||(246&e[l+1])!=240){"number"!=typeof a&&(a=l),l++;continue}if("number"==typeof a&&(this.skipWarn_(a,l),a=null),s=(1&~e[l+1])*2,r=(3&e[l+3])<<11|e[l+4]<<3|(224&e[l+5])>>5,h=(d=((3&e[l+6])+1)*1024)*p/u[(60&e[l+2])>>>2],e.byteLength-l<r)break;this.trigger("data",{pts:n.pts+i*h,dts:n.dts+i*h,sampleCount:d,audioobjecttype:(e[l+2]>>>6&3)+1,channelcount:(1&e[l+2])<<2|(192&e[l+3])>>>6,samplerate:u[(60&e[l+2])>>>2],samplingfrequencyindex:(60&e[l+2])>>>2,samplesize:16,data:e.subarray(l+7+s,l+r)}),i++,l+=r}"number"==typeof a&&(this.skipWarn_(a,l),a=null),e=e.subarray(l)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){e=void 0,this.trigger("reset")},this.endTimeline=function(){e=void 0,this.trigger("endedtimeline")}}).prototype=new i;var l,c,f,m=function(t){var e=t.byteLength,i=0,n=0;this.length=function(){return 8*e},this.bitsAvailable=function(){return 8*e+n},this.loadWord=function(){var a=t.byteLength-e,r=new Uint8Array(4),s=Math.min(4,e);if(0===s)throw Error("no bytes available");r.set(t.subarray(a,a+s)),i=new DataView(r.buffer).getUint32(0),n=8*s,e-=s},this.skipBits=function(t){var a;n>t||(t-=n,a=Math.floor(t/8),t-=8*a,e-=a,this.loadWord()),i<<=t,n-=t},this.readBits=function(t){var a=Math.min(n,t),r=i>>>32-a;return(n-=a)>0?i<<=a:e>0&&this.loadWord(),(a=t-a)>0?r<<a|this.readBits(a):r},this.skipLeadingZeros=function(){var t;for(t=0;t<n;++t)if(i&2147483648>>>t)return i<<=t,n-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(c=function(){var t,e,i=0;c.prototype.init.call(this),this.push=function(n){var a;e?((a=new Uint8Array(e.byteLength+n.data.byteLength)).set(e),a.set(n.data,e.byteLength),e=a):e=n.data;for(var r=e.byteLength;i<r-3;i++)if(1===e[i+2]){t=i+5;break}for(;t<r;)switch(e[t]){case 0:if(0!==e[t-1]){t+=2;break}if(0!==e[t-2]){t++;break}i+3!==t-2&&this.trigger("data",e.subarray(i+3,t-2));do t++;while(1!==e[t]&&t<r);i=t-2,t+=3;break;case 1:if(0!==e[t-1]||0!==e[t-2]){t+=3;break}this.trigger("data",e.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}e=e.subarray(i),t-=i,i=0},this.reset=function(){e=null,i=0,this.trigger("reset")},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(i+3)),e=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new i,f={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(l=function(){var t,e,i,n,a,r,s,o=new c;l.prototype.init.call(this),t=this,this.push=function(t){"video"===t.type&&(e=t.trackId,i=t.pts,n=t.dts,o.push(t))},o.on("data",function(s){var o={trackId:e,pts:i,dts:n,data:s,nalUnitTypeCode:31&s[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=a(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=a(s.subarray(1)),o.config=r(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}t.trigger("data",o)}),o.on("done",function(){t.trigger("done")}),o.on("partialdone",function(){t.trigger("partialdone")}),o.on("reset",function(){t.trigger("reset")}),o.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},s=function(t,e){var i,n=8,a=8;for(i=0;i<t;i++)0!==a&&(a=(n+e.readExpGolomb()+256)%256),n=0===a?n:a},a=function(t){for(var e,i,n=t.byteLength,a=[],r=1;r<n-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return t;e=n-a.length,i=new Uint8Array(e);var s=0;for(r=0;r<e;s++,r++)s===a[0]&&(s++,a.shift()),i[r]=t[s];return i},r=function(t){var e,i,n,a,r,o,d,h,p,u,l,c,g=0,y=0,b=0,v=0,S=[1,1];if(i=(e=new m(t)).readUnsignedByte(),a=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),f[i]&&(3===(r=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(l=3!==r?8:12,c=0;c<l;c++)e.readBoolean()&&(c<6?s(16,e):s(64,e));if(e.skipUnsignedExpGolomb(),0===(o=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===o)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),d=e.readUnsignedExpGolomb(),c=0;c<d;c++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),h=e.readUnsignedExpGolomb(),p=e.readUnsignedExpGolomb(),0===(u=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(g=e.readUnsignedExpGolomb(),y=e.readUnsignedExpGolomb(),b=e.readUnsignedExpGolomb(),v=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}S&&(S[0],S[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:a,width:(h+1)*16-2*g-2*y,height:(2-u)*(p+1)*16-2*b-2*v,sarRatio:S}}}).prototype=new i;var g,y,b,v,S,T,w,_,k,U,A,D,C,P,I,E,L,O,x,M,R,N,B,F,V,z,G,W,q={H264Stream:l,NalByteStream:c},j={Adts:d,h264:q},K={getUint64:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getBigUint64?(e=i.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(e):e:4294967296*i.getUint32(0)+i.getUint32(4)},MAX_UINT32:4294967296},H=K.MAX_UINT32;(function(){var t;if(L={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(t in L)L.hasOwnProperty(t)&&(L[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);O=new Uint8Array([105,115,111,109]),M=new Uint8Array([97,118,99,49]),x=new Uint8Array([0,0,0,1]),R={video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])},F=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),B=new Uint8Array([0,0,0,0,0,0,0,0]),z=V=new Uint8Array([0,0,0,0,0,0,0,0]),G=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),W=V,N=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),g=function(t){var e,i,n=[],a=0;for(e=1;e<arguments.length;e++)n.push(arguments[e]);for(e=n.length;e--;)a+=n[e].byteLength;for(i=new Uint8Array(a+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(t,4),e=0,a=8;e<n.length;e++)i.set(n[e],a),a+=n[e].byteLength;return i},y=function(){return g(L.ftyp,O,x,O,M)},U=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),g(L.mdhd,e)},k=function(t){var e;return g(L.mdia,U(t),(e=t.type,g(L.hdlr,R[e])),b(t))},b=function(t){return g(L.minf,"video"===t.type?g(L.vmhd,N):g(L.smhd,B),g(L.dinf,g(L.dref,F)),D(t))},v=function(t){for(var e=t.length,i=[];e--;)i[e]=w(t[e]);return g.apply(null,[L.moov,T(4294967295)].concat(i).concat(S(t)))},S=function(t){for(var e=t.length,i=[];e--;)i[e]=I(t[e]);return g.apply(null,[L.mvex].concat(i))},T=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return g(L.mvhd,e)},A=function(t){var e,i,n=t.samples||[],a=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)e=n[i].flags,a[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return g(L.sdtp,a)},D=function(t){return g(L.stbl,C(t),g(L.stts,W),g(L.stsc,z),g(L.stsz,G),g(L.stco,V))},C=function(t){return g(L.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?Y(t):X(t))},Y=function(t){var e,i,n=t.sps||[],a=t.pps||[],r=[],s=[];for(e=0;e<n.length;e++)r.push((65280&n[e].byteLength)>>>8),r.push(255&n[e].byteLength),r=r.concat(Array.prototype.slice.call(n[e]));for(e=0;e<a.length;e++)s.push((65280&a[e].byteLength)>>>8),s.push(255&a[e].byteLength),s=s.concat(Array.prototype.slice.call(a[e]));if(i=[L.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),g(L.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([n.length],r,[a.length],s))),g(L.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],t.sarRatio){var o=t.sarRatio[0],d=t.sarRatio[1];i.push(g(L.pasp,new Uint8Array([(4278190080&o)>>24,(16711680&o)>>16,(65280&o)>>8,255&o,(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))}return g.apply(null,i)},X=function(t){return g(L.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),g(L.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2])))},_=function(t){var e=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return g(L.tkhd,e)},P=function(t){var e,i,n,a,r,s;return e=g(L.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),r=Math.floor(t.baseMediaDecodeTime/H),s=Math.floor(t.baseMediaDecodeTime%H),i=g(L.tfdt,new Uint8Array([1,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),"audio"===t.type?(n=E(t,92),g(L.traf,e,i,n)):(a=A(t),n=E(t,a.length+92),g(L.traf,e,i,n,a))},w=function(t){return t.duration=t.duration||4294967295,g(L.trak,_(t),k(t))},I=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),g(L.trex,e)},J=function(t,e){var i=0,n=0,a=0,r=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(a=4),void 0!==t[0].compositionTimeOffset&&(r=8)),[0,0,i|n|a|r,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},$=function(t,e){var i,n,a,r,s,o;for(e+=20+16*(r=t.samples||[]).length,a=J(r,e),(n=new Uint8Array(a.length+16*r.length)).set(a),i=a.length,o=0;o<r.length;o++)s=r[o],n[i++]=(4278190080&s.duration)>>>24,n[i++]=(16711680&s.duration)>>>16,n[i++]=(65280&s.duration)>>>8,n[i++]=255&s.duration,n[i++]=(4278190080&s.size)>>>24,n[i++]=(16711680&s.size)>>>16,n[i++]=(65280&s.size)>>>8,n[i++]=255&s.size,n[i++]=s.flags.isLeading<<2|s.flags.dependsOn,n[i++]=s.flags.isDependedOn<<6|s.flags.hasRedundancy<<4|s.flags.paddingValue<<1|s.flags.isNonSyncSample,n[i++]=61440&s.flags.degradationPriority,n[i++]=15&s.flags.degradationPriority,n[i++]=(4278190080&s.compositionTimeOffset)>>>24,n[i++]=(16711680&s.compositionTimeOffset)>>>16,n[i++]=(65280&s.compositionTimeOffset)>>>8,n[i++]=255&s.compositionTimeOffset;return g(L.trun,n)},Z=function(t,e){var i,n,a,r,s,o;for(e+=20+8*(r=t.samples||[]).length,a=J(r,e),(i=new Uint8Array(a.length+8*r.length)).set(a),n=a.length,o=0;o<r.length;o++)s=r[o],i[n++]=(4278190080&s.duration)>>>24,i[n++]=(16711680&s.duration)>>>16,i[n++]=(65280&s.duration)>>>8,i[n++]=255&s.duration,i[n++]=(4278190080&s.size)>>>24,i[n++]=(16711680&s.size)>>>16,i[n++]=(65280&s.size)>>>8,i[n++]=255&s.size;return g(L.trun,i)},E=function(t,e){return"audio"===t.type?Z(t,e):$(t,e)};var Y,X,Z,$,J,Q,tt={ftyp:y,mdat:function(t){return g(L.mdat,t)},moof:function(t,e){for(var i=[],n=e.length;n--;)i[n]=P(e[n]);return g.apply(null,[L.moof,g(L.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))].concat(i))},moov:v,initSegment:function(t){var e,i=y(),n=v(t);return(e=new Uint8Array(i.byteLength+n.byteLength)).set(i),e.set(n,i.byteLength),e}},te={toUnsigned:function(t){return t>>>0},toHexString:function(t){return("00"+t.toString(16)).slice(-2)}},ti=function(t){return""+(String.fromCharCode(t[0])+String.fromCharCode(t[1])+String.fromCharCode(t[2])+String.fromCharCode(t[3]))},tn=te.toUnsigned,ta=function t(e,i){var n,a,r,s,o,d=[];if(!i.length)return null;for(n=0;n<e.byteLength;)a=tn(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),r=ti(e.subarray(n+4,n+8)),s=a>1?n+a:e.byteLength,r===i[0]&&(1===i.length?d.push(e.subarray(n+8,s)):(o=t(e.subarray(n+8,s),i.slice(1))).length&&(d=d.concat(o))),n=s;return d},tr=function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},a=1&n.flags[2],r=2&n.flags[2],s=8&n.flags[2],o=16&n.flags[2],d=32&n.flags[2],h=65536&n.flags[0],p=131072&n.flags[0];return e=8,a&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),r&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),s&&(n.defaultSampleDuration=i.getUint32(e),e+=4),o&&(n.defaultSampleSize=i.getUint32(e),e+=4),d&&(n.defaultSampleFlags=i.getUint32(e)),h&&(n.durationIsEmpty=!0),!a&&p&&(n.baseDataOffsetIsMoof=!0),n},ts=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},to=function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),a=1&i.flags[2],r=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],d=4&i.flags[1],h=8&i.flags[1],p=n.getUint32(4),u=8;for(a&&(i.dataOffset=n.getInt32(u),u+=4),r&&p&&(e={flags:ts(t.subarray(u,u+4))},u+=4,s&&(e.duration=n.getUint32(u),u+=4),o&&(e.size=n.getUint32(u),u+=4),h&&(1===i.version?e.compositionTimeOffset=n.getInt32(u):e.compositionTimeOffset=n.getUint32(u),u+=4),i.samples.push(e),p--);p--;)e={},s&&(e.duration=n.getUint32(u),u+=4),o&&(e.size=n.getUint32(u),u+=4),d&&(e.flags=ts(t.subarray(u,u+4)),u+=4),h&&(1===i.version?e.compositionTimeOffset=n.getInt32(u):e.compositionTimeOffset=n.getUint32(u),u+=4),i.samples.push(e);return i},td=te.toUnsigned,th=K.getUint64,tp=function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4))};return 1===e.version?e.baseMediaDecodeTime=th(t.subarray(4)):e.baseMediaDecodeTime=td(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),e},tu=te.toUnsigned,tl=te.toHexString,tc=K.getUint64;Q=function(t){var e=0===t[0]?12:20;return tu(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])};var tf,tm=function(t,e){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=e,i.compositionTimeOffset=t.pts-t.dts,i.duration=t.duration,i.size=4*t.length,i.size+=t.byteLength,t.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},tg={groupNalsIntoFrames:function(t){var e,i,n=[],a=[];for(a.byteLength=0,a.nalCount=0,a.duration=0,n.byteLength=0,e=0;e<t.length;e++)"access_unit_delimiter_rbsp"===(i=t[e]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,a.byteLength+=n.byteLength,a.nalCount+=n.length,a.duration+=n.duration,a.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return a.length&&(!n.duration||n.duration<=0)&&(n.duration=a[a.length-1].duration),a.byteLength+=n.byteLength,a.nalCount+=n.length,a.duration+=n.duration,a.push(n),a},groupFramesIntoGops:function(t){var e,i,n=[],a=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=t[0].pts,a.dts=t[0].dts,e=0;e<t.length;e++)(i=t[e]).keyFrame?(n.length&&(a.push(n),a.byteLength+=n.byteLength,a.nalCount+=n.nalCount,a.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return a.length&&n.duration<=0&&(n.duration=a[a.length-1].duration),a.byteLength+=n.byteLength,a.nalCount+=n.nalCount,a.duration+=n.duration,a.push(n),a},extendFirstKeyFrame:function(t){var e;return!t[0][0].keyFrame&&t.length>1&&(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t},generateSampleTable:function(t,e){var i,n,a,r,s=e||0,o=[];for(i=0;i<t.length;i++)for(r=t[i],n=0;n<r.length;n++)a=tm(r[n],s),s+=a.size,o.push(a);return o},concatenateNalData:function(t){var e,i,n,a,r,s,o=0,d=t.byteLength,h=t.nalCount,p=new Uint8Array(d+4*h),u=new DataView(p.buffer);for(e=0;e<t.length;e++)for(a=t[e],i=0;i<a.length;i++)for(r=a[i],n=0;n<r.length;n++)s=r[n],u.setUint32(o,s.data.byteLength),o+=4,p.set(s.data,o),o+=s.data.byteLength;return p},generateSampleTableForFrame:function(t,e){var i=[];return i.push(tm(t,e||0)),i},concatenateNalDataForFrame:function(t){var e,i,n=0,a=t.byteLength,r=t.length,s=new Uint8Array(a+4*r),o=new DataView(s.buffer);for(e=0;e<t.length;e++)i=t[e],o.setUint32(n,i.data.byteLength),n+=4,s.set(i.data,n),n+=i.data.byteLength;return s}},ty=[33,16,5,32,164,27],tb=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],tv=function(t){for(var e=[];t--;)e.push(0);return e},tS=function(){if(!tf){var t;tf=Object.keys(t={96e3:[ty,[227,64],tv(154),[56]],88200:[ty,[231],tv(170),[56]],64e3:[ty,[248,192],tv(240),[56]],48e3:[ty,[255,192],tv(268),[55,148,128],tv(54),[112]],44100:[ty,[255,192],tv(268),[55,163,128],tv(84),[112]],32e3:[ty,[255,192],tv(268),[55,234],tv(226),[112]],24e3:[ty,[255,192],tv(268),[55,255,128],tv(268),[111,112],tv(126),[224]],16e3:[ty,[255,192],tv(268),[55,255,128],tv(268),[111,255],tv(269),[223,108],tv(195),[1,192]],12e3:[tb,tv(268),[3,127,248],tv(268),[6,255,240],tv(268),[13,255,224],tv(268),[27,253,128],tv(259),[56]],11025:[tb,tv(268),[3,127,248],tv(268),[6,255,240],tv(268),[13,255,224],tv(268),[27,255,192],tv(268),[55,175,128],tv(108),[112]],8e3:[tb,tv(268),[3,121,16],tv(47),[7]]}).reduce(function(e,i){return e[i]=new Uint8Array(t[i].reduce(function(t,e){return t.concat(e)},[])),e},{})}return tf},tT=function(t){var e,i=0;for(e=0;e<t.length;e++)i+=t[e].data.byteLength;return i},tw={prefixWithSilence:function(t,e,i,n){var a,r,s,o,d=0,p=0,u=0;if(e.length&&(a=h.audioTsToVideoTs(t.baseMediaDecodeTime,t.samplerate),d=Math.ceil(h.ONE_SECOND_IN_TS/(t.samplerate/1024)),i&&n&&(u=(p=Math.floor((a-Math.max(i,n))/d))*d),!(p<1||u>h.ONE_SECOND_IN_TS/2))){for((r=tS()[t.samplerate])||(r=e[0].data),s=0;s<p;s++)o=e[0],e.splice(0,0,{data:r,dts:o.dts-d,pts:o.pts-d});return t.baseMediaDecodeTime-=Math.floor(h.videoTsToAudioTs(u,t.samplerate)),u}},trimAdtsFramesByEarliestDts:function(t,e,i){return e.minSegmentDts>=i?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=i&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))},generateSampleTable:function(t){var e,i=[];for(e=0;e<t.length;e++)i.push({size:t[e].data.byteLength,duration:1024});return i},concatenateFrameData:function(t){var e,i,n=0,a=new Uint8Array(tT(t));for(e=0;e<t.length;e++)i=t[e],a.set(i.data,n),n+=i.data.byteLength;return a}},t_=h.ONE_SECOND_IN_TS,tk={clearDtsInfo:function(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(t,e){var i,n=t.minSegmentDts;return e||(n-=t.timelineStartInfo.dts),i=Math.max(0,i=t.timelineStartInfo.baseMediaDecodeTime+n),"audio"===t.type&&(i*=t.samplerate/t_,i=Math.floor(i)),i},collectDtsInfo:function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))}},tU={parseSei:function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,a=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)a+=255,e++;if(a+=t[e++],!i.payload&&4===n){if("GA94"===String.fromCharCode(t[e+3],t[e+4],t[e+5],t[e+6])){i.payloadType=n,i.payloadSize=a,i.payload=t.subarray(e,e+a);break}i.payload=void 0}e+=a,n=0,a=0}return i},parseUserData:function(t){return 181!==t.payload[0]||(t.payload[1]<<8|t.payload[2])!=49||"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])||3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)},parseCaptionPackets:function(t,e){var i,n,a,r,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)r={type:3&e[(a=3*i)+2],pts:t},4&e[a+2]&&(r.ccData=e[a+3]<<8|e[a+4],s.push(r));return s},discardEmulationPreventionBytes:function(t){for(var e,i,n=t.byteLength,a=[],r=1;r<n-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return t;e=n-a.length,i=new Uint8Array(e);var s=0;for(r=0;r<e;s++,r++)s===a[0]&&(s++,a.shift()),i[r]=t[s];return i},USER_DATA_REGISTERED_ITU_T_T35:4},tA=function t(e){e=e||{},t.prototype.init.call(this),this.parse708captions_="boolean"!=typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new tN(0,0),new tN(0,1),new tN(1,0),new tN(1,1)],this.parse708captions_&&(this.cc708Stream_=new tL({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};tA.prototype=new i,tA.prototype.push=function(t){var e,i,n;if("sei_rbsp"===t.nalUnitType&&(e=tU.parseSei(t.escapedRBSP)).payload&&e.payloadType===tU.USER_DATA_REGISTERED_ITU_T_T35&&(i=tU.parseUserData(e))){if(t.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}n=tU.parseCaptionPackets(t.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},tA.prototype.flushCCStreams=function(t){this.ccStreams_.forEach(function(e){return"flush"===t?e.flush():e.partialFlush()},this)},tA.prototype.flushStream=function(t){if(!this.captionPackets_.length){this.flushCCStreams(t);return}this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(function(t){t.type<2?this.dispatchCea608Packet(t):this.dispatchCea708Packet(t)},this),this.captionPackets_.length=0,this.flushCCStreams(t)},tA.prototype.flush=function(){return this.flushStream("flush")},tA.prototype.partialFlush=function(){return this.flushStream("partialFlush")},tA.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(t){t.reset()})},tA.prototype.dispatchCea608Packet=function(t){this.setsTextOrXDSActive(t)?this.activeCea608Channel_[t.type]=null:this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),null!==this.activeCea608Channel_[t.type]&&this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},tA.prototype.setsChannel1Active=function(t){return(30720&t.ccData)==4096},tA.prototype.setsChannel2Active=function(t){return(30720&t.ccData)==6144},tA.prototype.setsTextOrXDSActive=function(t){return(28928&t.ccData)==256||(30974&t.ccData)==4138||(30974&t.ccData)==6186},tA.prototype.dispatchCea708Packet=function(t){this.parse708captions_&&this.cc708Stream_.push(t)};var tD={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},tC=function(t){var e=tD[t]||t;return 4096&t&&t===e?"":String.fromCharCode(e)},tP=function(t){return 32<=t&&t<=127||160<=t&&t<=255},tI=function(t){this.windowNum=t,this.reset()};tI.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},tI.prototype.getText=function(){return this.rows.join(`
`)},tI.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},tI.prototype.newLine=function(t){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(t),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},tI.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},tI.prototype.addText=function(t){this.rows[this.rowIdx]+=t},tI.prototype.backspace=function(){if(!this.isEmpty()){var t=this.rows[this.rowIdx];this.rows[this.rowIdx]=t.substr(0,t.length-1)}};var tE=function(t,e,i){this.serviceNum=t,this.text="",this.currentWindow=new tI(-1),this.windows=[],this.stream=i,"string"==typeof e&&this.createTextDecoder(e)};tE.prototype.init=function(t,e){this.startPts=t;for(var i=0;i<8;i++)this.windows[i]=new tI(i),"function"==typeof e&&(this.windows[i].beforeRowOverflow=e)},tE.prototype.setCurrentWindow=function(t){this.currentWindow=this.windows[t]},tE.prototype.createTextDecoder=function(t){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(t)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+t+" encoding. "+e})}};var tL=function t(e){e=e||{},t.prototype.init.call(this);var i,n=this,a=e.captionServices||{},r={};Object.keys(a).forEach(function(t){i=a[t],/^SERVICE/.test(t)&&(r[t]=i.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(t){3===t.type?n.new708Packet():null===n.current708Packet&&n.new708Packet(),n.add708Bytes(t)}};tL.prototype=new i,tL.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},tL.prototype.add708Bytes=function(t){var e=t.ccData;this.current708Packet.ptsVals.push(t.pts),this.current708Packet.data.push(e>>>8),this.current708Packet.data.push(255&e)},tL.prototype.push708Packet=function(){var t=this.current708Packet,e=t.data,i=null,n=null,a=0,r=e[a++];for(t.seq=r>>6,t.sizeCode=63&r;a<e.length;a++)i=(r=e[a++])>>5,n=31&r,7===i&&n>0&&(i=r=e[a++]),this.pushServiceBlock(i,a,n),n>0&&(a+=n-1)},tL.prototype.pushServiceBlock=function(t,e,i){var n,a=e,r=this.current708Packet.data,s=this.services[t];for(s||(s=this.initService(t,a));a<e+i&&a<r.length;a++)tP(n=r[a])?a=this.handleText(a,s):24===n?a=this.multiByteCharacter(a,s):16===n?a=this.extendedCommands(a,s):128<=n&&n<=135?a=this.setCurrentWindow(a,s):152<=n&&n<=159?a=this.defineWindow(a,s):136===n?a=this.clearWindows(a,s):140===n?a=this.deleteWindows(a,s):137===n?a=this.displayWindows(a,s):138===n?a=this.hideWindows(a,s):139===n?a=this.toggleWindows(a,s):151===n?a=this.setWindowAttributes(a,s):144===n?a=this.setPenAttributes(a,s):145===n?a=this.setPenColor(a,s):146===n?a=this.setPenLocation(a,s):143===n?s=this.reset(a,s):8===n?s.currentWindow.backspace():12===n?s.currentWindow.clearText():13===n?s.currentWindow.pendingNewLine=!0:14===n?s.currentWindow.clearText():141===n&&a++},tL.prototype.extendedCommands=function(t,e){return tP(this.current708Packet.data[++t])&&(t=this.handleText(t,e,{isExtended:!0})),t},tL.prototype.getPts=function(t){return this.current708Packet.ptsVals[Math.floor(t/2)]},tL.prototype.initService=function(t,e){var i,n="SERVICE"+t,a=this;return n in this.serviceEncodings&&(i=this.serviceEncodings[n]),this.services[t]=new tE(t,i,a),this.services[t].init(this.getPts(e),function(e){a.flushDisplayed(e,a.services[t])}),this.services[t]},tL.prototype.handleText=function(t,e,i){var n,a,r=i&&i.isExtended,s=i&&i.isMultiByte,o=this.current708Packet.data,d=o[t],h=o[t+1],p=e.currentWindow;return e.textDecoder_&&!r?(s?(a=[d,h],t++):a=[d],n=e.textDecoder_.decode(new Uint8Array(a))):n=tC((r?4096:0)|d),p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(t)),p.pendingNewLine=!1,p.addText(n),t},tL.prototype.multiByteCharacter=function(t,e){var i=this.current708Packet.data,n=i[t+1],a=i[t+2];return tP(n)&&tP(a)&&(t=this.handleText(++t,e,{isMultiByte:!0})),t},tL.prototype.setCurrentWindow=function(t,e){var i=this.current708Packet.data[t];return e.setCurrentWindow(7&i),t},tL.prototype.defineWindow=function(t,e){var i=this.current708Packet.data,n=i[t],a=7&n;e.setCurrentWindow(a);var r=e.currentWindow;return n=i[++t],r.visible=(32&n)>>5,r.rowLock=(16&n)>>4,r.columnLock=(8&n)>>3,r.priority=7&n,n=i[++t],r.relativePositioning=(128&n)>>7,r.anchorVertical=127&n,n=i[++t],r.anchorHorizontal=n,n=i[++t],r.anchorPoint=(240&n)>>4,r.rowCount=15&n,n=i[++t],r.columnCount=63&n,n=i[++t],r.windowStyle=(56&n)>>3,r.penStyle=7&n,r.virtualRowCount=r.rowCount+1,t},tL.prototype.setWindowAttributes=function(t,e){var i=this.current708Packet.data,n=i[t],a=e.currentWindow.winAttr;return n=i[++t],a.fillOpacity=(192&n)>>6,a.fillRed=(48&n)>>4,a.fillGreen=(12&n)>>2,a.fillBlue=3&n,n=i[++t],a.borderType=(192&n)>>6,a.borderRed=(48&n)>>4,a.borderGreen=(12&n)>>2,a.borderBlue=3&n,n=i[++t],a.borderType+=(128&n)>>5,a.wordWrap=(64&n)>>6,a.printDirection=(48&n)>>4,a.scrollDirection=(12&n)>>2,a.justify=3&n,n=i[++t],a.effectSpeed=(240&n)>>4,a.effectDirection=(12&n)>>2,a.displayEffect=3&n,t},tL.prototype.flushDisplayed=function(t,e){for(var i=[],n=0;n<8;n++)e.windows[n].visible&&!e.windows[n].isEmpty()&&i.push(e.windows[n].getText());e.endPts=t,e.text=i.join(`

`),this.pushCaption(e),e.startPts=t},tL.prototype.pushCaption=function(t){""!==t.text&&(this.trigger("data",{startPts:t.startPts,endPts:t.endPts,text:t.text,stream:"cc708_"+t.serviceNum}),t.text="",t.startPts=t.endPts)},tL.prototype.displayWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible=1);return t},tL.prototype.hideWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible=0);return t},tL.prototype.toggleWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible^=1);return t},tL.prototype.clearWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var a=0;a<8;a++)i&1<<a&&e.windows[a].clearText();return t},tL.prototype.deleteWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var a=0;a<8;a++)i&1<<a&&e.windows[a].reset();return t},tL.prototype.setPenAttributes=function(t,e){var i=this.current708Packet.data,n=i[t],a=e.currentWindow.penAttr;return n=i[++t],a.textTag=(240&n)>>4,a.offset=(12&n)>>2,a.penSize=3&n,n=i[++t],a.italics=(128&n)>>7,a.underline=(64&n)>>6,a.edgeType=(56&n)>>3,a.fontStyle=7&n,t},tL.prototype.setPenColor=function(t,e){var i=this.current708Packet.data,n=i[t],a=e.currentWindow.penColor;return n=i[++t],a.fgOpacity=(192&n)>>6,a.fgRed=(48&n)>>4,a.fgGreen=(12&n)>>2,a.fgBlue=3&n,n=i[++t],a.bgOpacity=(192&n)>>6,a.bgRed=(48&n)>>4,a.bgGreen=(12&n)>>2,a.bgBlue=3&n,n=i[++t],a.edgeRed=(48&n)>>4,a.edgeGreen=(12&n)>>2,a.edgeBlue=3&n,t},tL.prototype.setPenLocation=function(t,e){var i=this.current708Packet.data,n=i[t],a=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,n=i[++t],a.row=15&n,n=i[++t],a.column=63&n,t},tL.prototype.reset=function(t,e){var i=this.getPts(t);return this.flushDisplayed(i,e),this.initService(e.serviceNum,t)};var tO={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},tx=function(t){return null===t?"":String.fromCharCode(t=tO[t]||t)},tM=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],tR=function(){for(var t=[],e=15;e--;)t.push("");return t},tN=function t(e,i){t.prototype.init.call(this),this.field_=e||0,this.dataChannel_=i||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,a,r;if((e=32639&t.ccData)===this.lastControlCode_){this.lastControlCode_=null;return}if((61440&e)==4096?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),n=e>>>8,a=255&e,e!==this.PADDING_){if(e===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(e===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;else if(e===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(t.pts);else if(e===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(t.pts);else if(e===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(t.pts);else if(e===this.CARRIAGE_RETURN_)this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;else if(e===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(e===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(t.pts),this.displayed_=tR();else if(e===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=tR();else if(e===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=tR()),this.mode_="paintOn",this.startPts_=t.pts;else if(this.isSpecialCharacter(n,a))r=tx((n=(3&n)<<8)|a),this[this.mode_](t.pts,r),this.column_++;else if(this.isExtCharacter(n,a))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),r=tx((n=(3&n)<<8)|a),this[this.mode_](t.pts,r),this.column_++;else if(this.isMidRowCode(n,a))this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,(14&a)==14&&this.addFormatting(t.pts,["i"]),(1&a)==1&&this.addFormatting(t.pts,["u"]);else if(this.isOffsetControlCode(n,a))this.column_+=3&a;else if(this.isPAC(n,a)){var s=tM.indexOf(7968&e);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(t.pts,s)),s!==this.row_&&(this.clearFormatting(t.pts),this.row_=s),1&a&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),(16&e)==16&&(this.column_=((14&e)>>1)*4),this.isColorPAC(a)&&(14&a)==14&&this.addFormatting(t.pts,["i"])}else this.isNormalChar(n)&&(0===a&&(a=null),r=tx(n)+tx(a),this[this.mode_](t.pts,r),this.column_+=r.length)}}};tN.prototype=new i,tN.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t,e){try{return t.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_})},tN.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=tR(),this.nonDisplayed_=tR(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},tN.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},tN.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&e>=48&&e<=63},tN.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&e>=32&&e<=63},tN.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&e>=32&&e<=47},tN.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&e>=33&&e<=35},tN.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&e>=64&&e<=127},tN.prototype.isColorPAC=function(t){return t>=64&&t<=79||t>=96&&t<=127},tN.prototype.isNormalChar=function(t){return t>=32&&t<=127},tN.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=tR(),this.displayed_=tR()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},tN.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);var i=e.reduce(function(t,e){return t+"<"+e+">"},"");this[this.mode_](t,i)},tN.prototype.clearFormatting=function(t){if(this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,e){return t+"</"+e+">"},"");this.formatting_=[],this[this.mode_](t,e)}},tN.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];i+=e,this.nonDisplayed_[this.row_]=i},tN.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},tN.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},tN.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i};var tB={CaptionStream:tA,Cea608Stream:tN,Cea708Stream:tL},tF={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},tV="shared",tz=function(t,e){var i=1;for(t>e&&(i=-1);Math.abs(e-t)>4294967296;)t+=8589934592*i;return t},tG=function t(e){var i,n;t.prototype.init.call(this),this.type_=e||tV,this.push=function(t){this.type_!==tV&&t.type!==this.type_||(void 0===n&&(n=t.dts),t.dts=tz(t.dts,n),t.pts=tz(t.pts,n),i=t.dts,this.trigger("data",t))},this.flush=function(){n=i,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,i=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};tG.prototype=new i;var tW,tq={TimestampRolloverStream:tG,handleRollover:tz},tj=function(t,e,i){if(!t)return -1;for(var n=i;n<t.length;n++)if(t[n]===e)return n;return -1},tK={Utf8:3},tH=function(t,e,i){var n,a="";for(n=e;n<i;n++)a+="%"+("00"+t[n].toString(16)).slice(-2);return a},tY=function(t,e,i){return decodeURIComponent(tH(t,e,i))},tX=function(t,e,i){return unescape(tH(t,e,i))},tZ=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},t$={APIC:function(t){var e,i,n=1;t.data[0]!==tK.Utf8||(e=tj(t.data,0,n))<0||(t.mimeType=tX(t.data,n,e),n=e+1,t.pictureType=t.data[n],n++,(i=tj(t.data,0,n))<0||(t.description=tY(t.data,n,i),n=i+1,"-->"===t.mimeType?t.url=tX(t.data,n,t.data.length):t.pictureData=t.data.subarray(n,t.data.length)))},"T*":function(t){t.data[0]===tK.Utf8&&(t.value=tY(t.data,1,t.data.length).replace(/\0*$/,""),t.values=t.value.split("\x00"))},TXXX:function(t){var e;t.data[0]===tK.Utf8&&-1!==(e=tj(t.data,0,1))&&(t.description=tY(t.data,1,e),t.value=tY(t.data,e+1,t.data.length).replace(/\0*$/,""),t.data=t.value)},"W*":function(t){t.url=tX(t.data,0,t.data.length).replace(/\0.*$/,"")},WXXX:function(t){var e;t.data[0]===tK.Utf8&&-1!==(e=tj(t.data,0,1))&&(t.description=tY(t.data,1,e),t.url=tX(t.data,e+1,t.data.length).replace(/\0.*$/,""))},PRIV:function(t){var e;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=tX(t.data,0,e);break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};(tW=function(t){var e,i={descriptor:t&&t.descriptor},n=0,a=[],r=0;if(tW.prototype.init.call(this),this.dispatchType=tF.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(e=0;e<i.descriptor.length;e++)this.dispatchType+=("00"+i.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,i,s,o,d;if("timed-metadata"===t.type){if(t.dataAlignmentIndicator&&(r=0,a.length=0),0===a.length&&(t.data.length<10||73!==t.data[0]||68!==t.data[1]||51!==t.data[2])){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(a.push(t),r+=t.data.byteLength,1===a.length&&(n=tZ(t.data.subarray(6,10))+10),!(r<n)){for(e={data:new Uint8Array(n),frames:[],pts:a[0].pts,dts:a[0].dts},d=0;d<n;)e.data.set(a[0].data.subarray(0,n-d),d),d+=a[0].data.byteLength,r-=a[0].data.byteLength,a.shift();i=10,64&e.data[5]&&(i+=4+tZ(e.data.subarray(10,14)),n-=tZ(e.data.subarray(16,20)));do{if((s=tZ(e.data.subarray(i+4,i+8)))<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if((o={id:String.fromCharCode(e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]),data:e.data.subarray(i+10,i+s+10)}).key=o.id,t$[o.id]?t$[o.id](o):"T"===o.id[0]?t$["T*"](o):"W"===o.id[0]&&t$["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var h=o.data,p=(1&h[3])<<30|h[4]<<22|h[5]<<14|h[6]<<6|h[7]>>>2;p*=4,p+=3&h[7],o.timeStamp=p,void 0===e.pts&&void 0===e.dts&&(e.pts=o.timeStamp,e.dts=o.timeStamp),this.trigger("timestamp",o)}e.frames.push(o),i+=10+s}while(i<n);this.trigger("data",e)}}}}).prototype=new i;var tJ,tQ,t0,t1=tq.TimestampRolloverStream;(tJ=function(){var t=new Uint8Array(188),e=0;tJ.prototype.init.call(this),this.push=function(i){var n,a=0,r=188;for(e?((n=new Uint8Array(i.byteLength+e)).set(t.subarray(0,e)),n.set(i,e),e=0):n=i;r<n.byteLength;){if(71===n[a]&&71===n[r]){this.trigger("data",n.subarray(a,r)),a+=188,r+=188;continue}a++,r++}a<n.byteLength&&(t.set(n.subarray(a),0),e=n.byteLength-a)},this.flush=function(){188===e&&71===t[0]&&(this.trigger("data",t),e=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){e=0,this.trigger("reset")}}).prototype=new i,(tQ=function(){var t,e,i,n;tQ.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,t=function(t,n){var a=0;n.payloadUnitStartIndicator&&(a+=t[a]+1),"pat"===n.type?e(t.subarray(a),n):i(t.subarray(a),n)},e=function(t,e){e.section_number=t[7],e.last_section_number=t[8],n.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=n.pmtPid},i=function(t,e){var i,a;if(1&t[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&t[1])<<8|t[2])-4,a=12+((15&t[10])<<8|t[11]);a<i;){var r=t[a],s=(31&t[a+1])<<8|t[a+2];r===tF.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=s:r===tF.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=s:r===tF.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][s]=r),a+=((15&t[a+3])<<8|t[a+4])+5}e.programMapTable=n.programMapTable}},this.push=function(e){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&e[1]),i.pid=31&e[1],i.pid<<=8,i.pid|=e[2],(48&e[3])>>>4>1&&(n+=e[n]+1),0===i.pid)i.type="pat",t(e.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",t(e.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,n,i]):this.processPes_(e,n,i)},this.processPes_=function(t,e,i){i.pid===this.programMapTable.video?i.streamType=tF.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=tF.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}}).prototype=new i,tQ.STREAM_TYPES={h264:27,adts:15},(t0=function(){var t,e=this,i=!1,n={data:[],size:0},a={data:[],size:0},r={data:[],size:0},s=function(t,e){var i,n=t[0]<<16|t[1]<<8|t[2];e.data=new Uint8Array,1===n&&(e.packetLength=6+(t[4]<<8|t[5]),e.dataAlignmentIndicator=(4&t[6])!=0,192&(i=t[7])&&(e.pts=(14&t[9])<<27|(255&t[10])<<20|(254&t[11])<<12|(255&t[12])<<5|(254&t[13])>>>3,e.pts*=4,e.pts+=(6&t[13])>>>1,e.dts=e.pts,64&i&&(e.dts=(14&t[14])<<27|(255&t[15])<<20|(254&t[16])<<12|(255&t[17])<<5|(254&t[18])>>>3,e.dts*=4,e.dts+=(6&t[18])>>>1)),e.data=t.subarray(9+t[8]))},o=function(t,i,n){var a,r=new Uint8Array(t.size),o={type:i},d=0,h=0,p=!1;if(!(!t.data.length||t.size<9)){for(o.trackId=t.data[0].pid,d=0;d<t.data.length;d++)a=t.data[d],r.set(a.data,h),h+=a.data.byteLength;s(r,o),p="video"===i||o.packetLength<=t.size,(n||p)&&(t.size=0,t.data.length=0),p&&e.trigger("data",o)}};t0.prototype.init.call(this),this.push=function(s){({pat:function(){},pes:function(){var t,e;switch(s.streamType){case tF.H264_STREAM_TYPE:t=n,e="video";break;case tF.ADTS_STREAM_TYPE:t=a,e="audio";break;case tF.METADATA_STREAM_TYPE:t=r,e="timed-metadata";break;default:return}s.payloadUnitStartIndicator&&o(t,e,!0),t.data.push(s),t.size+=s.data.byteLength},pmt:function(){var n={type:"metadata",tracks:[]};null!==(t=s.programMapTable).video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),null!==t.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),i=!0,e.trigger("data",n)}})[s.type]()},this.reset=function(){n.size=0,n.data.length=0,a.size=0,a.data.length=0,this.trigger("reset")},this.flushStreams_=function(){o(n,"video"),o(a,"audio"),o(r,"timed-metadata")},this.flush=function(){if(!i&&t){var n={type:"metadata",tracks:[]};null!==t.video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),null!==t.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),e.trigger("data",n)}i=!1,this.flushStreams_(),this.trigger("done")}}).prototype=new i;var t2={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:tJ,TransportParseStream:tQ,ElementaryStream:t0,TimestampRolloverStream:t1,CaptionStream:tB.CaptionStream,Cea608Stream:tB.Cea608Stream,Cea708Stream:tB.Cea708Stream,MetadataStream:tW};for(var t8 in tF)tF.hasOwnProperty(t8)&&(t2[t8]=tF[t8]);var t4,t6=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],t5=function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return i=i>=0?i:0,(16&t[e+5])>>4?i+20:i+10},t3=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},t7=function(t,e,i){var n,a="";for(n=e;n<i;n++)a+="%"+("00"+t[n].toString(16)).slice(-2);return a},t9={isLikelyAacData:function(t){var e=function t(e,i){return e.length-i<10||73!==e[i]||68!==e[i+1]||51!==e[i+2]?i:(i+=t5(e,i),t(e,i))}(t,0);return t.length>=e+2&&(255&t[e])==255&&(240&t[e+1])==240&&(22&t[e+1])==16},parseId3TagSize:t5,parseAdtsSize:function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i},parseType:function(t,e){return 73===t[e]&&68===t[e+1]&&51===t[e+2]?"timed-metadata":!0&t[e]&&(240&t[e+1])==240?"audio":null},parseSampleRate:function(t){for(var e=0;e+5<t.length;){if(255!==t[e]||(246&t[e+1])!=240){e++;continue}return t6[(60&t[e+2])>>>2]}return null},parseAacTimestamp:function(t){var e,i,n;e=10,64&t[5]&&(e+=4+t3(t.subarray(10,14)));do{if((i=t3(t.subarray(e+4,e+8)))<1)break;if("PRIV"===String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3])){n=t.subarray(e+10,e+i+10);for(var a=0;a<n.byteLength;a++)if(0===n[a]){if("com.apple.streaming.transportStreamTimestamp"===unescape(t7(n,0,a))){var r=n.subarray(a+1),s=(1&r[3])<<30|r[4]<<22|r[5]<<14|r[6]<<6|r[7]>>>2;return s*=4,s+=3&r[7]}break}}e+=10+i}while(e<t.byteLength);return null}};(t4=function(){var t=new Uint8Array,e=0;t4.prototype.init.call(this),this.setTimestamp=function(t){e=t},this.push=function(i){var n,a,r,s=0,o=0;for(t.length?(r=t.length,(t=new Uint8Array(i.byteLength+r)).set(t.subarray(0,r)),t.set(i,r)):t=i;t.length-o>=3;){if(73===t[o]&&68===t[o+1]&&51===t[o+2]){if(t.length-o<10||(s=t9.parseId3TagSize(t,o),o+s>t.length))break;n={type:"timed-metadata",data:t.subarray(o,o+s)},this.trigger("data",n),o+=s;continue}if((255&t[o])==255&&(240&t[o+1])==240){if(t.length-o<7||(s=t9.parseAdtsSize(t,o),o+s>t.length))break;a={type:"audio",data:t.subarray(o,o+s),pts:e,dts:e},this.trigger("data",a),o+=s;continue}o++}t=t.length-o>0?t.subarray(o):new Uint8Array},this.reset=function(){t=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){t=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new i;var et,ee,ei,en,ea=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],er=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],es=q.H264Stream,eo=t9.isLikelyAacData,ed=h.ONE_SECOND_IN_TS,eh=function(t,e){e.stream=t,this.trigger("log",e)},ep=function(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++){var a=i[n];"headOfPipeline"!==a&&e[a].on&&e[a].on("log",eh.bind(t,a))}},eu=function(t,e){var i;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},el=function(t,e,i,n,a,r){return{start:{dts:t,pts:t+(i-e)},end:{dts:t+(n-e),pts:t+(a-i)},prependedContentDuration:r,baseMediaDecodeTime:t}};(ee=function(t,e){var i,n=[],a=0,r=0,s=1/0;i=(e=e||{}).firstSequenceNumber||0,ee.prototype.init.call(this),this.push=function(e){tk.collectDtsInfo(t,e),t&&ea.forEach(function(i){t[i]=e[i]}),n.push(e)},this.setEarliestDts=function(t){a=t},this.setVideoBaseMediaDecodeTime=function(t){s=t},this.setAudioAppendStart=function(t){r=t},this.flush=function(){var o,d,p,u,l,c,f;if(0===n.length){this.trigger("done","AudioSegmentStream");return}o=tw.trimAdtsFramesByEarliestDts(n,t,a),t.baseMediaDecodeTime=tk.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),f=tw.prefixWithSilence(t,o,r,s),t.samples=tw.generateSampleTable(o),p=tt.mdat(tw.concatenateFrameData(o)),n=[],d=tt.moof(i,[t]),u=new Uint8Array(d.byteLength+p.byteLength),i++,u.set(d),u.set(p,d.byteLength),tk.clearDtsInfo(t),l=Math.ceil(1024*ed/t.samplerate),o.length&&(c=o.length*l,this.trigger("segmentTimingInfo",el(h.audioTsToVideoTs(t.baseMediaDecodeTime,t.samplerate),o[0].dts,o[0].pts,o[0].dts+c,o[0].pts+c,f||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+c})),this.trigger("data",{track:t,boxes:u}),this.trigger("done","AudioSegmentStream")},this.reset=function(){tk.clearDtsInfo(t),n=[],this.trigger("reset")}}).prototype=new i,(et=function(t,e){var i,n,a,r=[],s=[];i=(e=e||{}).firstSequenceNumber||0,et.prototype.init.call(this),delete t.minPTS,this.gopCache_=[],this.push=function(e){tk.collectDtsInfo(t,e),"seq_parameter_set_rbsp"!==e.nalUnitType||n||(n=e.config,t.sps=[e.data],er.forEach(function(e){t[e]=n[e]},this)),"pic_parameter_set_rbsp"!==e.nalUnitType||a||(a=e.data,t.pps=[e.data]),r.push(e)},this.flush=function(){for(var n,a,o,d,h,p,u,l,c,f=0;r.length&&"access_unit_delimiter_rbsp"!==r[0].nalUnitType;)r.shift();if(0===r.length){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(a=tg.groupNalsIntoFrames(r),(d=tg.groupFramesIntoGops(a))[0][0].keyFrame||((o=this.getGopForFusion_(r[0],t))?(f=o.duration,d.unshift(o),d.byteLength+=o.byteLength,d.nalCount+=o.nalCount,d.pts=o.pts,d.dts=o.dts,d.duration+=o.duration):d=tg.extendFirstKeyFrame(d)),s.length){if(!(n=e.alignGopsAtEnd?this.alignGopsAtEnd_(d):this.alignGopsAtStart_(d))){this.gopCache_.unshift({gop:d.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),r=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}tk.clearDtsInfo(t),d=n}tk.collectDtsInfo(t,d),t.samples=tg.generateSampleTable(d),p=tt.mdat(tg.concatenateNalData(d)),t.baseMediaDecodeTime=tk.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),this.trigger("processedGopsInfo",d.map(function(t){return{pts:t.pts,dts:t.dts,byteLength:t.byteLength}})),l=d[0],c=d[d.length-1],this.trigger("segmentTimingInfo",el(t.baseMediaDecodeTime,l.dts,l.pts,c.dts+c.duration,c.pts+c.duration,f)),this.trigger("timingInfo",{start:d[0].pts,end:d[d.length-1].pts+d[d.length-1].duration}),this.gopCache_.unshift({gop:d.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),r=[],this.trigger("baseMediaDecodeTime",t.baseMediaDecodeTime),this.trigger("timelineStartInfo",t.timelineStartInfo),h=tt.moof(i,[t]),u=new Uint8Array(h.byteLength+p.byteLength),i++,u.set(h),u.set(p,h.byteLength),this.trigger("data",{track:t,boxes:u}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),r=[],this.gopCache_.length=0,s.length=0,this.trigger("reset")},this.resetStream_=function(){tk.clearDtsInfo(t),n=void 0,a=void 0},this.getGopForFusion_=function(e){var i,n,a,r,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)a=(r=this.gopCache_[s]).gop,!(!(t.pps&&eu(t.pps[0],r.pps[0]))||!(t.sps&&eu(t.sps[0],r.sps[0])))&&(a.dts<t.timelineStartInfo.dts||(i=e.dts-a.dts-a.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=r,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(t){var e,i,n,a,r,o,d,h;for(r=t.byteLength,o=t.nalCount,d=t.duration,e=i=0;e<s.length&&i<t.length&&(n=s[e],a=t[i],n.pts!==a.pts);){if(a.pts>n.pts){e++;continue}i++,r-=a.byteLength,o-=a.nalCount,d-=a.duration}return 0===i?t:i===t.length?null:((h=t.slice(i)).byteLength=r,h.duration=d,h.nalCount=o,h.pts=h[0].pts,h.dts=h[0].dts,h)},this.alignGopsAtEnd_=function(t){for(e=s.length-1,i=t.length-1,r=null,o=!1;e>=0&&i>=0;){if(n=s[e],a=t[i],n.pts===a.pts){o=!0;break}if(n.pts>a.pts){e--;continue}e===s.length-1&&(r=i),i--}if(!o&&null===r)return null;if(0===(d=o?i:r))return t;var e,i,n,a,r,o,d,h=t.slice(d),p=h.reduce(function(t,e){return t.byteLength+=e.byteLength,t.duration+=e.duration,t.nalCount+=e.nalCount,t},{byteLength:0,duration:0,nalCount:0});return h.byteLength=p.byteLength,h.duration=p.duration,h.nalCount=p.nalCount,h.pts=h[0].pts,h.dts=h[0].dts,h},this.alignGopsWith=function(t){s=t}}).prototype=new i,(en=function(t,e){this.numberOfTracks=0,this.metadataStream=e,"u">typeof(t=t||{}).remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,"boolean"==typeof t.keepOriginalTimestamps?this.keepOriginalTimestamps=t.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,en.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):void(this.pendingTracks.push(t.track),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track,this.pendingBoxes.push(t.boxes)),"audio"===t.track.type&&(this.audioTrack=t.track,this.pendingBoxes.unshift(t.boxes)))}}).prototype=new i,en.prototype.flush=function(t){var e,i,n,a,r=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t||this.remuxTracks)return;if(0===this.pendingTracks.length){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,er.forEach(function(t){s.info[t]=this.videoTrack[t]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,ea.forEach(function(t){s.info[t]=this.audioTrack[t]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=tt.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),a=0;a<this.pendingBoxes.length;a++)s.data.set(this.pendingBoxes[a],r),r+=this.pendingBoxes[a].byteLength;for(a=0;a<this.pendingCaptions.length;a++)(e=this.pendingCaptions[a]).startTime=h.metadataTsToSeconds(e.startPts,o,this.keepOriginalTimestamps),e.endTime=h.metadataTsToSeconds(e.endPts,o,this.keepOriginalTimestamps),s.captionStreams[e.stream]=!0,s.captions.push(e);for(a=0;a<this.pendingMetadata.length;a++)(i=this.pendingMetadata[a]).cueTime=h.metadataTsToSeconds(i.pts,o,this.keepOriginalTimestamps),s.metadata.push(i);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),a=0;a<s.captions.length;a++)e=s.captions[a],this.trigger("caption",e);for(a=0;a<s.metadata.length;a++)i=s.metadata[a],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},en.prototype.setRemux=function(t){this.remuxTracks=t},(ei=function(t){var e,i,n=this,a=!0;ei.prototype.init.call(this),t=t||{},this.baseMediaDecodeTime=t.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="aac",a.metadataStream=new t2.MetadataStream,a.aacStream=new t4,a.audioTimestampRolloverStream=new t2.TimestampRolloverStream("audio"),a.timedMetadataTimestampRolloverStream=new t2.TimestampRolloverStream("timed-metadata"),a.adtsStream=new d,a.coalesceStream=new en(t,a.metadataStream),a.headOfPipeline=a.aacStream,a.aacStream.pipe(a.audioTimestampRolloverStream).pipe(a.adtsStream),a.aacStream.pipe(a.timedMetadataTimestampRolloverStream).pipe(a.metadataStream).pipe(a.coalesceStream),a.metadataStream.on("timestamp",function(t){a.aacStream.setTimestamp(t.timeStamp)}),a.aacStream.on("data",function(r){"timed-metadata"!==r.type&&"audio"!==r.type||a.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"},a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new ee(i,t),a.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e}))}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),ep(this,a)},this.setupTsPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="ts",a.metadataStream=new t2.MetadataStream,a.packetStream=new t2.TransportPacketStream,a.parseStream=new t2.TransportParseStream,a.elementaryStream=new t2.ElementaryStream,a.timestampRolloverStream=new t2.TimestampRolloverStream,a.adtsStream=new d,a.h264Stream=new es,a.captionStream=new t2.CaptionStream(t),a.coalesceStream=new en(t,a.metadataStream),a.headOfPipeline=a.packetStream,a.packetStream.pipe(a.parseStream).pipe(a.elementaryStream).pipe(a.timestampRolloverStream),a.timestampRolloverStream.pipe(a.h264Stream),a.timestampRolloverStream.pipe(a.adtsStream),a.timestampRolloverStream.pipe(a.metadataStream).pipe(a.coalesceStream),a.h264Stream.pipe(a.captionStream).pipe(a.coalesceStream),a.elementaryStream.on("data",function(r){var s;if("metadata"===r.type){for(s=r.tracks.length;s--;)e||"video"!==r.tracks[s].type?i||"audio"!==r.tracks[s].type||((i=r.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime):(e=r.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime;e&&!a.videoSegmentStream&&(a.coalesceStream.numberOfTracks++,a.videoSegmentStream=new et(e,t),a.videoSegmentStream.on("log",n.getLogTrigger_("videoSegmentStream")),a.videoSegmentStream.on("timelineStartInfo",function(e){i&&!t.keepOriginalTimestamps&&(i.timelineStartInfo=e,a.audioSegmentStream.setEarliestDts(e.dts-n.baseMediaDecodeTime))}),a.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo")),a.videoSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"videoSegmentTimingInfo")),a.videoSegmentStream.on("baseMediaDecodeTime",function(t){i&&a.audioSegmentStream.setVideoBaseMediaDecodeTime(t)}),a.videoSegmentStream.on("timingInfo",n.trigger.bind(n,"videoTimingInfo")),a.h264Stream.pipe(a.videoSegmentStream).pipe(a.coalesceStream)),i&&!a.audioSegmentStream&&(a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new ee(i,t),a.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),a.audioSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"audioSegmentTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e})}}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("id3Frame",function(t){t.dispatchType=a.metadataStream.dispatchType,n.trigger("id3Frame",t)}),a.coalesceStream.on("caption",this.trigger.bind(this,"caption")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),ep(this,a)},this.setBaseMediaDecodeTime=function(n){var a=this.transmuxPipeline_;t.keepOriginalTimestamps||(this.baseMediaDecodeTime=n),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,tk.clearDtsInfo(i),a.audioTimestampRolloverStream&&a.audioTimestampRolloverStream.discontinuity()),e&&(a.videoSegmentStream&&(a.videoSegmentStream.gopCache_=[]),e.timelineStartInfo.dts=void 0,e.timelineStartInfo.pts=void 0,tk.clearDtsInfo(e),a.captionStream.reset()),a.timestampRolloverStream&&a.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(t){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(t)},this.setRemux=function(e){var i=this.transmuxPipeline_;t.remux=e,i&&i.coalesceStream&&i.coalesceStream.setRemux(e)},this.alignGopsWith=function(t){e&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(t)},this.getLogTrigger_=function(t){var e=this;return function(i){i.stream=t,e.trigger("log",i)}},this.push=function(t){if(a){var e=eo(t);e&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),a=!1}this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){a=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new i;var ec,ef={Transmuxer:ei,VideoSegmentStream:et,AudioSegmentStream:ee},em=tU.discardEmulationPreventionBytes,eg=tB.CaptionStream,ey=function(t,e){for(var i=t,n=0;n<e.length;n++){var a=e[n];if(i<a.size)return a;i-=a.size}return null},eb=function(t,e,i){var n,a,r,s,o=new DataView(t.buffer,t.byteOffset,t.byteLength),d={logs:[],seiNals:[]};for(a=0;a+4<t.length;a+=r)if(r=o.getUint32(a),a+=4,!(r<=0))switch(31&t[a]){case 6:var h=t.subarray(a+1,a+1+r),p=ey(a,e);if(n={nalUnitType:"sei_rbsp",size:r,data:h,escapedRBSP:em(h),trackId:i},p)n.pts=p.pts,n.dts=p.dts,s=p;else if(s)n.pts=s.pts,n.dts=s.dts;else{d.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+a+" for trackId "+i+". See mux.js#223."});break}d.seiNals.push(n)}return d},ev=function(t,i,n){var a=i,r=n.defaultSampleDuration||0,s=n.defaultSampleSize||0,o=n.trackId,d=[];return t.forEach(function(t){var i=to(t).samples;i.forEach(function(t){void 0===t.duration&&(t.duration=r),void 0===t.size&&(t.size=s),t.trackId=o,t.dts=a,void 0===t.compositionTimeOffset&&(t.compositionTimeOffset=0),"bigint"==typeof a?(t.pts=a+e.default.BigInt(t.compositionTimeOffset),a+=e.default.BigInt(t.duration)):(t.pts=a+t.compositionTimeOffset,a+=t.duration)}),d=d.concat(i)}),d},eS=function(t,e){var i=ta(t,["moof","traf"]),n=ta(t,["mdat"]),a={},r=[];return n.forEach(function(t,e){var n=i[e];r.push({mdat:t,traf:n})}),r.forEach(function(t){var i,n=t.mdat,r=t.traf,s=tr(ta(r,["tfhd"])[0]),o=s.trackId,d=ta(r,["tfdt"]),h=d.length>0?tp(d[0]).baseMediaDecodeTime:0,p=ta(r,["trun"]);e===o&&p.length>0&&(i=eb(n,ev(p,h,s),o),a[o]||(a[o]={seiNals:[],logs:[]}),a[o].seiNals=a[o].seiNals.concat(i.seiNals),a[o].logs=a[o].logs.concat(i.logs))}),a},eT=function(t,e,i){if(null===e)return null;var n=eS(t,e)[e]||{};return{seiNals:n.seiNals,logs:n.logs,timescale:i}},ew={generator:tt,probe:{findBox:ta,parseType:ti,timescale:function(t){return ta(t,["moov","trak"]).reduce(function(t,e){var i,n,a,r;return(i=ta(e,["tkhd"])[0])&&(n=0===i[0]?12:20,a=tu(i[n]<<24|i[n+1]<<16|i[n+2]<<8|i[n+3]),r=ta(e,["mdia","mdhd"])[0])?(n=0===r[0]?12:20,t[a]=tu(r[n]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3]),t):null},{})},startTime:function(t,i){var n=ta(i,["moof","traf"]).reduce(function(i,n){var a,r,s=ta(n,["tfhd"])[0],o=t[tu(s[4]<<24|s[5]<<16|s[6]<<8|s[7])]||9e4,d=ta(n,["tfdt"])[0],h=new DataView(d.buffer,d.byteOffset,d.byteLength);return"bigint"==typeof(r=1===d[0]?tc(d.subarray(4,12)):h.getUint32(4))?a=r/e.default.BigInt(o):"number"!=typeof r||isNaN(r)||(a=r/o),a<Number.MAX_SAFE_INTEGER&&(a=Number(a)),a<i&&(i=a),i},1/0);return"bigint"==typeof n||isFinite(n)?n:0},compositionStartTime:function(t,i){var n,a=ta(i,["moof","traf"]),r=0,s=0;if(a&&a.length){var o=ta(a[0],["tfhd"])[0],d=ta(a[0],["trun"])[0],h=ta(a[0],["tfdt"])[0];if(o&&(n=tr(o).trackId),h&&(r=tp(h).baseMediaDecodeTime),d){var p=to(d);p.samples&&p.samples.length&&(s=p.samples[0].compositionTimeOffset||0)}}var u=t[n]||9e4;"bigint"==typeof r&&(s=e.default.BigInt(s),u=e.default.BigInt(u));var l=(r+s)/u;return"bigint"==typeof l&&l<Number.MAX_SAFE_INTEGER&&(l=Number(l)),l},videoTrackIds:function(t){var e=ta(t,["moov","trak"]),i=[];return e.forEach(function(t){var e=ta(t,["mdia","hdlr"]),n=ta(t,["tkhd"]);e.forEach(function(t,e){var a,r,s=ti(t.subarray(8,12)),o=n[e];"vide"===s&&(r=0===(a=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?a.getUint32(12):a.getUint32(20),i.push(r))})}),i},tracks:function(t){var e=ta(t,["moov","trak"]),i=[];return e.forEach(function(t){var e,n,a={},r=ta(t,["tkhd"])[0];r&&(n=(e=new DataView(r.buffer,r.byteOffset,r.byteLength)).getUint8(0),a.id=0===n?e.getUint32(12):e.getUint32(20));var s=ta(t,["mdia","hdlr"])[0];if(s){var o=ti(s.subarray(8,12));"vide"===o?a.type="video":"soun"===o?a.type="audio":a.type=o}var d=ta(t,["mdia","minf","stbl","stsd"])[0];if(d){var h=d.subarray(8);a.codec=ti(h.subarray(4,8));var p,u=ta(h,[a.codec])[0];u&&(/^[asm]vc[1-9]$/i.test(a.codec)?"avcC"===ti((p=u.subarray(78)).subarray(4,8))&&p.length>11?(a.codec+=".",a.codec+=tl(p[9]),a.codec+=tl(p[10]),a.codec+=tl(p[11])):a.codec="avc1.4d400d":/^mp4[a,v]$/i.test(a.codec)?"esds"===ti((p=u.subarray(28)).subarray(4,8))&&p.length>20&&0!==p[19]?(a.codec+="."+tl(p[19]),a.codec+="."+tl(p[20]>>>2&63).replace(/^0/,"")):a.codec="mp4a.40.2":a.codec=a.codec.toLowerCase())}var l=ta(t,["mdia","mdhd"])[0];l&&(a.timescale=Q(l)),i.push(a)}),i},getTimescaleFromMediaHeader:Q},Transmuxer:ef.Transmuxer,AudioSegmentStream:ef.AudioSegmentStream,VideoSegmentStream:ef.VideoSegmentStream,CaptionParser:function(){var t,e,i,n,a,r,s=!1;this.isInitialized=function(){return s},this.init=function(e){t=new eg,s=!0,r=!!e&&e.isPartial,t.on("data",function(t){t.startTime=t.startPts/n,t.endTime=t.endPts/n,a.captions.push(t),a.captionStreams[t.stream]=!0}),t.on("log",function(t){a.logs.push(t)})},this.isNewInit=function(t,e){return(!t||0!==t.length)&&(!e||"object"!=typeof e||0!==Object.keys(e).length)&&(i!==t[0]||n!==e[i])},this.parse=function(t,r,s){var o;if(!this.isInitialized()||!r||!s)return null;if(this.isNewInit(r,s))n=s[i=r[0]];else if(null===i||!n)return e.push(t),null;for(;e.length>0;){var d=e.shift();this.parse(d,r,s)}return(o=eT(t,i,n))&&o.logs&&(a.logs=a.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),a):a.logs.length?{logs:a.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(e){if(!this.isInitialized()||!e||0===e.length)return null;e.forEach(function(e){t.push(e)})},this.flushStream=function(){if(!this.isInitialized())return null;r?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){a.captions=[],a.captionStreams={},a.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){e=[],i=null,n=null,a?this.clearParsedCaptions():a={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()}};(ec=function(t,e){var i,n=0,a=16384,r=function(t,e){var i,n=t.position+e;n<t.bytes.byteLength||((i=new Uint8Array(2*n)).set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},s=ec.widthBytes||new Uint8Array(5),o=ec.heightBytes||new Uint8Array(6),d=ec.videocodecidBytes||new Uint8Array(12);if(!ec.widthBytes){for(i=0;i<5;i++)s[i]="width".charCodeAt(i);for(i=0;i<6;i++)o[i]="height".charCodeAt(i);for(i=0;i<12;i++)d[i]="videocodecid".charCodeAt(i);ec.widthBytes=s,ec.heightBytes=o,ec.videocodecidBytes=d}switch(this.keyFrame=!1,t){case ec.VIDEO_TAG:this.length=16,a*=6;break;case ec.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case ec.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw Error("Unknown FLV tag type")}this.bytes=new Uint8Array(a),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=e,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var n,a=e||0;n=a+(i=i||t.byteLength),r(this,i),this.bytes.set(t.subarray(a,n),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){r(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){r(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===n?0:this.length-(n+4)},this.startNalUnit=function(){if(n>0)throw Error("Attempted to create new NAL wihout closing the old one");n=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===n+4?this.length-=4:n>0&&(e=n+4,i=this.length-e,this.position=n,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),n=0},this.writeMetaDataDouble=function(t,e){var i;if(r(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(s,this.position),this.position+=5;else if("height"===t)this.bytes.set(o,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(d,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++n},this.writeMetaDataBoolean=function(t,e){var i;for(r(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)r(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;r(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++n},this.finalize=function(){var t,i;switch(this.bytes[0]){case ec.VIDEO_TAG:this.bytes[11]=(this.keyFrame||e?16:32)|7,this.bytes[12]=e?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case ec.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=e?0:1;break;case ec.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,n),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return i=this.length-11,this.bytes[1]=(16711680&i)>>>16,this.bytes[2]=(65280&i)>>>8,this.bytes[3]=(255&i)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,r(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=ec.frameTime(this.bytes),this}}).AUDIO_TAG=8,ec.VIDEO_TAG=9,ec.METADATA_TAG=18,ec.isAudioFrame=function(t){return ec.AUDIO_TAG===t[0]},ec.isVideoFrame=function(t){return ec.VIDEO_TAG===t[0]},ec.isMetaData=function(t){return ec.METADATA_TAG===t[0]},ec.isKeyFrame=function(t){return ec.isVideoFrame(t)?23===t[11]:!!(ec.isAudioFrame(t)||ec.isMetaData(t))},ec.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24};var e_=function t(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,t.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):void("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),"audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++))}};e_.prototype=new i,e_.prototype.flush=function(t){var e,i,n,a,r={tags:{},captions:[],captionStreams:{},metadata:[]};if((!(this.pendingTracks<this.numberOfTracks)||("VideoSegmentStream"===t||"AudioSegmentStream"===t)&&(0!==this.pendingTracks||(this.processedTracks++,!(this.processedTracks<this.numberOfTracks))))&&(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks))){for(this.videoTrack?a=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(a=this.audioTrack.timelineStartInfo.pts),r.tags.videoTags=this.videoTags,r.tags.audioTags=this.audioTags,n=0;n<this.pendingCaptions.length;n++)(i=this.pendingCaptions[n]).startTime=i.startPts-a,i.startTime/=9e4,i.endTime=i.endPts-a,i.endTime/=9e4,r.captionStreams[i.stream]=!0,r.captions.push(i);for(n=0;n<this.pendingMetadata.length;n++)(e=this.pendingMetadata[n]).cueTime=e.pts-a,e.cueTime/=9e4,r.metadata.push(e);r.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",r),this.trigger("done")}};var ek,eU,eA,eD,eC,eP,eI=function(){var t=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return t.list.length}})},eE=q.H264Stream;eD=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},eC=function(t,e){var i=new ec(ec.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},eP=function(t,e){var i,n=new ec(ec.VIDEO_TAG,!0);for(n.dts=e,n.pts=e,n.writeByte(1),n.writeByte(t.profileIdc),n.writeByte(t.profileCompatibility),n.writeByte(t.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(t.sps[0].length),n.writeBytes(t.sps[0]),n.writeByte(t.pps.length),i=0;i<t.pps.length;++i)n.writeShort(t.pps[i].length),n.writeBytes(t.pps[i]);return n},(eA=function(t){var e,i=[],n=[];eA.prototype.init.call(this),this.push=function(e){eD(t,e),t&&(t.audioobjecttype=e.audioobjecttype,t.channelcount=e.channelcount,t.samplerate=e.samplerate,t.samplingfrequencyindex=e.samplingfrequencyindex,t.samplesize=e.samplesize,t.extraData=t.audioobjecttype<<11|t.samplingfrequencyindex<<7|t.channelcount<<3),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),i.push(e)},this.flush=function(){var a,r,s,o=new eI;if(0===i.length){this.trigger("done","AudioSegmentStream");return}for(s=-1/0;i.length;)a=i.shift(),n.length&&a.pts>=n[0]&&(s=n.shift(),this.writeMetaDataTags(o,s)),(t.extraData!==e||a.pts-s>=1e3)&&(this.writeMetaDataTags(o,a.pts),e=t.extraData,s=a.pts),(r=new ec(ec.AUDIO_TAG)).pts=a.pts,r.dts=a.dts,r.writeBytes(a.data),o.push(r.finalize());n.length=0,e=null,this.trigger("data",{track:t,tags:o.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(e,i){var n;(n=new ec(ec.METADATA_TAG)).pts=i,n.dts=i,n.writeMetaDataDouble("audiocodecid",10),n.writeMetaDataBoolean("stereo",2===t.channelcount),n.writeMetaDataDouble("audiosamplerate",t.samplerate),n.writeMetaDataDouble("audiosamplesize",16),e.push(n.finalize()),(n=new ec(ec.AUDIO_TAG,!0)).pts=i,n.dts=i,n.view.setUint16(n.position,t.extraData),n.position+=2,n.length=Math.max(n.length,n.position),e.push(n.finalize())},this.onVideoKeyFrame=function(t){n.push(t)}}).prototype=new i,(eU=function(t){var e,i,n=[];eU.prototype.init.call(this),this.finishFrame=function(n,a){if(a){if(e&&t&&t.newMetadata&&(a.keyFrame||0===n.length)){var r=eC(e,a.dts).finalize(),s=eP(t,a.dts).finalize();r.metaDataTag=s.metaDataTag=!0,n.push(r),n.push(s),t.newMetadata=!1,this.trigger("keyframe",a.dts)}a.endNalUnit(),n.push(a.finalize()),i=null}},this.push=function(e){eD(t,e),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),n.push(e)},this.flush=function(){for(var a,r=new eI;n.length&&"access_unit_delimiter_rbsp"!==n[0].nalUnitType;)n.shift();if(0===n.length){this.trigger("done","VideoSegmentStream");return}for(;n.length;)"seq_parameter_set_rbsp"===(a=n.shift()).nalUnitType?(t.newMetadata=!0,e=a.config,t.width=e.width,t.height=e.height,t.sps=[a.data],t.profileIdc=e.profileIdc,t.levelIdc=e.levelIdc,t.profileCompatibility=e.profileCompatibility,i.endNalUnit()):"pic_parameter_set_rbsp"===a.nalUnitType?(t.newMetadata=!0,t.pps=[a.data],i.endNalUnit()):"access_unit_delimiter_rbsp"===a.nalUnitType?(i&&this.finishFrame(r,i),(i=new ec(ec.VIDEO_TAG)).pts=a.pts,i.dts=a.dts):("slice_layer_without_partitioning_rbsp_idr"===a.nalUnitType&&(i.keyFrame=!0),i.endNalUnit()),i.startNalUnit(),i.writeBytes(a.data);i&&this.finishFrame(r,i),this.trigger("data",{track:t,tags:r.list}),this.trigger("done","VideoSegmentStream")}}).prototype=new i,(ek=function(t){var e,i,n,a,r,s,o,h,p,u,l,c,f=this;ek.prototype.init.call(this),t=t||{},this.metadataStream=new t2.MetadataStream,t.metadataStream=this.metadataStream,e=new t2.TransportPacketStream,i=new t2.TransportParseStream,n=new t2.ElementaryStream,a=new t2.TimestampRolloverStream("video"),r=new t2.TimestampRolloverStream("audio"),s=new t2.TimestampRolloverStream("timed-metadata"),o=new d,h=new eE,c=new e_(t),e.pipe(i).pipe(n),n.pipe(a).pipe(h),n.pipe(r).pipe(o),n.pipe(s).pipe(this.metadataStream).pipe(c),l=new t2.CaptionStream(t),h.pipe(l).pipe(c),n.on("data",function(t){var e,i,n;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(n=t.tracks[e]);i&&!p&&(c.numberOfTracks++,p=new eU(i),h.pipe(p).pipe(c)),n&&!u&&(c.numberOfTracks++,u=new eA(n),o.pipe(u).pipe(c),p&&p.on("keyframe",u.onVideoKeyFrame))}}),this.push=function(t){e.push(t)},this.flush=function(){e.flush()},this.resetCaptions=function(){l.reset()},c.on("data",function(t){f.trigger("data",t)}),c.on("done",function(){f.trigger("done")})}).prototype=new i;var eL=h.ONE_SECOND_IN_TS,eO=function t(e,i){var n=[],a=0,r=0,s=0,o=1/0,d=null,h=null;i=i||{},t.prototype.init.call(this),this.push=function(t){tk.collectDtsInfo(e,t),e&&ea.forEach(function(i){e[i]=t[i]}),n.push(t)},this.setEarliestDts=function(t){r=t},this.setVideoBaseMediaDecodeTime=function(t){o=t},this.setAudioAppendStart=function(t){s=t},this.processFrames_=function(){var t,p,u,l,c;0!==n.length&&0!==(t=tw.trimAdtsFramesByEarliestDts(n,e,r)).length&&(e.baseMediaDecodeTime=tk.calculateTrackBaseMediaDecodeTime(e,i.keepOriginalTimestamps),tw.prefixWithSilence(e,t,s,o),e.samples=tw.generateSampleTable(t),u=tt.mdat(tw.concatenateFrameData(t)),n=[],p=tt.moof(a,[e]),a++,e.initSegment=tt.initSegment([e]),(l=new Uint8Array(p.byteLength+u.byteLength)).set(p),l.set(u,p.byteLength),tk.clearDtsInfo(e),null===d&&(h=d=t[0].pts),h+=t.length*(1024*eL/e.samplerate),c={start:d},this.trigger("timingInfo",c),this.trigger("data",{track:e,boxes:l}))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:d,end:h}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){tk.clearDtsInfo(e),d=null,h=null},this.reset=function(){this.resetTiming_(),n=[],this.trigger("reset")}};eO.prototype=new i;var ex=function t(e,i){var n,a,r,s=0,o=[],d=[],h=null,p=null,u=!0;i=i||{},t.prototype.init.call(this),this.push=function(t){tk.collectDtsInfo(e,t),typeof e.timelineStartInfo.dts>"u"&&(e.timelineStartInfo.dts=t.dts),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],er.forEach(function(t){e[t]=n[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||a||(a=t.data,e.pps=[t.data]),o.push(t)},this.processNals_=function(t){var n;for(o=d.concat(o);o.length&&"access_unit_delimiter_rbsp"!==o[0].nalUnitType;)o.shift();if(0!==o.length){var a=tg.groupNalsIntoFrames(o);if(a.length){if(d=a[a.length-1],t&&(a.pop(),a.duration-=d.duration,a.nalCount-=d.length,a.byteLength-=d.byteLength),!a.length){o=[];return}if(this.trigger("timelineStartInfo",e.timelineStartInfo),u){if(!(r=tg.groupFramesIntoGops(a))[0][0].keyFrame){if(!(r=tg.extendFirstKeyFrame(r))[0][0].keyFrame){o=[].concat.apply([],a).concat(d),d=[];return}(a=[].concat.apply([],r)).duration=r.duration}u=!1}for(null===h&&(p=h=a[0].pts),p+=a.duration,this.trigger("timingInfo",{start:h,end:p}),n=0;n<a.length;n++){var l=a[n];e.samples=tg.generateSampleTableForFrame(l);var c=tt.mdat(tg.concatenateNalDataForFrame(l));tk.clearDtsInfo(e),tk.collectDtsInfo(e,l),e.baseMediaDecodeTime=tk.calculateTrackBaseMediaDecodeTime(e,i.keepOriginalTimestamps);var f=tt.moof(s,[e]);s++,e.initSegment=tt.initSegment([e]);var m=new Uint8Array(f.byteLength+c.byteLength);m.set(f),m.set(c,f.byteLength),this.trigger("data",{track:e,boxes:m,sequence:s,videoFrameDts:l.dts,videoFramePts:l.pts})}o=[]}}},this.resetTimingAndConfig_=function(){n=void 0,a=void 0,h=null,p=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),d=[],o=[],u=!0,this.trigger("reset")}};ex.prototype=new i;var eM=t9.isLikelyAacData,eR=function(t){return t.prototype=new i,t.prototype.init.call(t),t},eN=function(t){var e={type:"ts",tracks:{audio:null,video:null},packet:new t2.TransportPacketStream,parse:new t2.TransportParseStream,elementary:new t2.ElementaryStream,timestampRollover:new t2.TimestampRolloverStream,adts:new j.Adts,h264:new j.h264.H264Stream,captionStream:new t2.CaptionStream(t),metadataStream:new t2.MetadataStream};return e.headOfPipeline=e.packet,e.packet.pipe(e.parse).pipe(e.elementary).pipe(e.timestampRollover),e.timestampRollover.pipe(e.h264),e.h264.pipe(e.captionStream),e.timestampRollover.pipe(e.metadataStream),e.timestampRollover.pipe(e.adts),e.elementary.on("data",function(i){if("metadata"===i.type){for(var n=0;n<i.tracks.length;n++)e.tracks[i.tracks[n].type]||(e.tracks[i.tracks[n].type]=i.tracks[n],e.tracks[i.tracks[n].type].timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);e.tracks.video&&!e.videoSegmentStream&&(e.videoSegmentStream=new ex(e.tracks.video,t),e.videoSegmentStream.on("timelineStartInfo",function(i){e.tracks.audio&&!t.keepOriginalTimestamps&&e.audioSegmentStream.setEarliestDts(i.dts-t.baseMediaDecodeTime)}),e.videoSegmentStream.on("timingInfo",e.trigger.bind(e,"videoTimingInfo")),e.videoSegmentStream.on("data",function(t){e.trigger("data",{type:"video",data:t})}),e.videoSegmentStream.on("done",e.trigger.bind(e,"done")),e.videoSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.videoSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.h264.pipe(e.videoSegmentStream)),e.tracks.audio&&!e.audioSegmentStream&&(e.audioSegmentStream=new eO(e.tracks.audio,t),e.audioSegmentStream.on("data",function(t){e.trigger("data",{type:"audio",data:t})}),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adts.pipe(e.audioSegmentStream)),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video})}}),e.captionStream.on("data",function(i){var n;n=e.tracks.video&&e.tracks.video.timelineStartInfo.pts||0,i.startTime=h.metadataTsToSeconds(i.startPts,n,t.keepOriginalTimestamps),i.endTime=h.metadataTsToSeconds(i.endPts,n,t.keepOriginalTimestamps),e.trigger("caption",i)}),(e=eR(e)).metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e},eB=function(t){var e={type:"aac",tracks:{audio:null},metadataStream:new t2.MetadataStream,aacStream:new t4,audioRollover:new t2.TimestampRolloverStream("audio"),timedMetadataRollover:new t2.TimestampRolloverStream("timed-metadata"),adtsStream:new d(!0)};return e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioRollover).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataRollover).pipe(e.metadataStream),e.metadataStream.on("timestamp",function(t){e.aacStream.setTimestamp(t.timeStamp)}),e.aacStream.on("data",function(i){"timed-metadata"!==i.type&&"audio"!==i.type||e.audioSegmentStream||(e.tracks.audio=e.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},e.audioSegmentStream=new eO(e.tracks.audio,t),e.audioSegmentStream.on("data",function(t){e.trigger("data",{type:"audio",data:t})}),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adtsStream.pipe(e.audioSegmentStream),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video}))}),(e=eR(e)).metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e},eF=function(t,e){t.on("data",e.trigger.bind(e,"data")),t.on("done",e.trigger.bind(e,"done")),t.on("partialdone",e.trigger.bind(e,"partialdone")),t.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),t.on("audioTimingInfo",e.trigger.bind(e,"audioTimingInfo")),t.on("videoTimingInfo",e.trigger.bind(e,"videoTimingInfo")),t.on("trackinfo",e.trigger.bind(e,"trackinfo")),t.on("id3Frame",function(i){i.dispatchType=t.metadataStream.dispatchType,i.cueTime=h.videoTsToSeconds(i.pts),e.trigger("id3Frame",i)}),t.on("caption",function(t){e.trigger("caption",t)})},eV=function t(e){var i=null,n=!0;e=e||{},t.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(t){if(n){var a=eM(t);a&&(!i||"aac"!==i.type)?eF(i=eB(e),this):a||i&&"ts"===i.type||eF(i=eN(e),this),n=!1}i.headOfPipeline.push(t)},this.flush=function(){i&&(n=!0,i.headOfPipeline.flush())},this.partialFlush=function(){i&&i.headOfPipeline.partialFlush()},this.endTimeline=function(){i&&i.headOfPipeline.endTimeline()},this.reset=function(){i&&i.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(t){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=t),i&&(i.tracks.audio&&(i.tracks.audio.timelineStartInfo.dts=void 0,i.tracks.audio.timelineStartInfo.pts=void 0,tk.clearDtsInfo(i.tracks.audio),i.audioRollover&&i.audioRollover.discontinuity()),i.tracks.video&&(i.videoSegmentStream&&(i.videoSegmentStream.gopCache_=[]),i.tracks.video.timelineStartInfo.dts=void 0,i.tracks.video.timelineStartInfo.pts=void 0,tk.clearDtsInfo(i.tracks.video)),i.timestampRollover&&i.timestampRollover.discontinuity())},this.setRemux=function(t){e.remux=t,i&&i.coalesceStream&&i.coalesceStream.setRemux(t)},this.setAudioAppendStart=function(t){i&&i.tracks.audio&&i.audioSegmentStream&&i.audioSegmentStream.setAudioAppendStart(t)},this.alignGopsWith=function(t){}};eV.prototype=new i;var ez,eG,eW=K.getUint64,eq=K.getUint64,ej=function(t){return new Date(1e3*t-20828448e5)},eK=function(t){var e,i,n=new DataView(t.buffer,t.byteOffset,t.byteLength),a=[];for(e=0;e+4<t.length;e+=i){if(i=n.getUint32(e),e+=4,i<=0){a.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(31&t[e]){case 1:a.push("slice_layer_without_partitioning_rbsp");break;case 5:a.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:a.push("sei_rbsp");break;case 7:a.push("seq_parameter_set_rbsp");break;case 8:a.push("pic_parameter_set_rbsp");break;case 9:a.push("access_unit_delimiter_rbsp");break;default:a.push("UNKNOWN NAL - "+t[e]&31)}}return a},eH={avc1:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:ez(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,a,r=new DataView(t.buffer,t.byteOffset,t.byteLength),s={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},o=31&t[5];for(n=6,a=0;a<o;a++)i=r.getUint16(n),n+=2,s.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,a=0;a<e;a++)i=r.getUint16(n),n+=2,s.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return s},btrt:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},edts:function(t){return{boxes:ez(t)}},elst:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),edits:[]},a=i.getUint32(4);for(e=8;a;a--)0===n.version?(n.edits.push({segmentDuration:i.getUint32(e),mediaTime:i.getInt32(e+4),mediaRate:i.getUint16(e+8)+i.getUint16(e+10)/65536}),e+=12):(n.edits.push({segmentDuration:eq(t.subarray(e)),mediaTime:eq(t.subarray(e+8)),mediaRate:i.getUint16(e+16)+i.getUint16(e+18)/65536}),e+=20);return n},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:ti(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(ti(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:ez(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:ez(t.subarray(8))}},hdlr:function(t){var e={version:new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0),flags:new Uint8Array(t.subarray(1,4)),handlerType:ti(t.subarray(8,12)),name:""},i=8;for(i=24;i<t.byteLength;i++){if(0===t[i]){i++;break}e.name+=String.fromCharCode(t[i])}return e.name=decodeURIComponent(escape(e.name)),e},mdat:function(t){return{byteLength:t.byteLength,nals:eK(t)}},mdhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=4,a={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===a.version?(n+=4,a.creationTime=ej(i.getUint32(n)),n+=8,a.modificationTime=ej(i.getUint32(n)),n+=4,a.timescale=i.getUint32(n),n+=8):(a.creationTime=ej(i.getUint32(n)),n+=4,a.modificationTime=ej(i.getUint32(n)),n+=4,a.timescale=i.getUint32(n),n+=4),a.duration=i.getUint32(n),n+=4,e=i.getUint16(n),a.language+=String.fromCharCode((e>>10)+96),a.language+=String.fromCharCode(((992&e)>>5)+96),a.language+=String.fromCharCode((31&e)+96),a},mdia:function(t){return{boxes:ez(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:ez(t)}},mp4a:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return t.byteLength>28&&(i.streamDescriptor=ez(t.subarray(28))[0]),i},moof:function(t){return{boxes:ez(t)}},moov:function(t){return{boxes:ez(t)}},mvex:function(t){return{boxes:ez(t)}},mvhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=ej(e.getUint32(i)),i+=8,n.modificationTime=ej(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8):(n.creationTime=ej(e.getUint32(i)),i+=4,n.modificationTime=ej(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4),n.duration=e.getUint32(i),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=12,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=60,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},n=12;0===i.version?(i.earliestPresentationTime=e.getUint32(n),i.firstOffset=e.getUint32(n+4),n+=8):(i.earliestPresentationTime=eW(t.subarray(n)),i.firstOffset=eW(t.subarray(n+8)),n+=16),n+=2;var a=e.getUint16(n);for(n+=2;a>0;n+=12,a--)i.references.push({referenceType:(128&t[n])>>>7,referencedSize:2147483647&e.getUint32(n),subsegmentDuration:e.getUint32(n+4),startsWithSap:!!(128&t[n+8]),sapType:(112&t[n+8])>>>4,sapDeltaTime:268435455&e.getUint32(n+8)});return i},smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:ez(t)}},ctts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),compositionOffsets:[]},a=i.getUint32(4);for(e=8;a;e+=8,a--)n.compositionOffsets.push({sampleCount:i.getUint32(e),sampleOffset:i[0===n.version?"getUint32":"getInt32"](e+4)});return n},stss:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),syncSamples:[]},a=i.getUint32(4);for(e=8;a;e+=4,a--)n.syncSamples.push(i.getUint32(e));return n},stco:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},a=i.getUint32(4);for(e=8;a;e+=4,a--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),a={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)a.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return a},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:ez(t.subarray(8))}},stsz:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},a=i.getUint32(4);for(e=8;a;e+=8,a--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return eH.ftyp(t)},tfdt:tp,tfhd:tr,tkhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=ej(e.getUint32(i)),i+=8,n.modificationTime=ej(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=12):(n.creationTime=ej(e.getUint32(i)),i+=4,n.modificationTime=ej(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=8),n.duration=e.getUint32(i),i+=12,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=4,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/65536,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/65536,n},traf:function(t){return{boxes:ez(t)}},trak:function(t){return{boxes:ez(t)}},trex:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:to,"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}},eY={inspect:ez=function(t){for(var e,i,n,a,r,s=0,o=[],d=new ArrayBuffer(t.length),h=new Uint8Array(d),p=0;p<t.length;++p)h[p]=t[p];for(e=new DataView(d);s<t.byteLength;)i=e.getUint32(s),n=ti(t.subarray(s+4,s+8)),a=i>1?s+i:t.byteLength,(r=(eH[n]||function(t){return{data:t}})(t.subarray(s+8,a))).size=i,r.type=n,o.push(r),s=a;return o},textify:eG=function(t,e){var i;return i=Array(2*(e=e||0)+1).join(" "),t.map(function(t,n){return i+t.type+`
`+Object.keys(t).filter(function(t){return"type"!==t&&"boxes"!==t}).map(function(e){var n=i+"  "+e+": ",a=t[e];if(a instanceof Uint8Array||a instanceof Uint32Array){var r=Array.prototype.slice.call(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)).map(function(t){return" "+("00"+t.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return r?1===r.length?n+"<"+r.join("").slice(1)+">":n+`<
`+r.map(function(t){return i+"  "+t}).join(`
`)+`
`+i+"  >":n+"<>"}return n+JSON.stringify(a,null,2).split(`
`).map(function(t,e){return 0===e?t:i+"  "+t}).join(`
`)}).join(`
`)+(t.boxes?`
`+eG(t.boxes,e+1):"")}).join(`
`)},parseType:ti,findBox:ta,parseTraf:eH.traf,parseTfdt:eH.tfdt,parseHdlr:eH.hdlr,parseTfhd:eH.tfhd,parseTrun:eH.trun,parseSidx:eH.sidx},eX={8:"audio",9:"video",18:"metadata"},eZ=function(t){for(var e,i=[];t.byteLength>0;)e=0,i.push("0x"+("00"+t[e++].toString(16)).slice(-2).toUpperCase()),t=t.subarray(e);return i.join(" ")},e$=function(t,e){var i=t[1]&parseInt("01111111",2)<<16|t[2]<<8|t[3];return(e=e||{}).avcPacketType=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"][t[0]],e.CompositionTime=t[1]&parseInt("10000000",2)?-i:i,1===t[0]?e.nalUnitTypeRaw=eZ(t.subarray(4,100)):e.data=eZ(t.subarray(4)),e},eJ=function(t,e){var i=t[0]&parseInt("00001111",2);return(e=e||{}).frameType=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"][(t[0]&parseInt("11110000",2))>>>4],e.codecID=i,7===i?e$(t.subarray(1),e):e},eQ=function(t,e){var i,n,a=(t[0]&parseInt("11110000",2))>>>4;return(e=e||{}).soundFormat=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"][a],e.soundRate=["5.5-kHz","11-kHz","22-kHz","44-kHz"][(t[0]&parseInt("00001100",2))>>>2],e.soundSize=(t[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",e.soundType=t[0]&parseInt("00000001",2)?"Stereo":"Mono",10===a?(i=t.subarray(1),(n=(n=e)||{}).aacPacketType=["AAC Sequence Header","AAC Raw"][i[0]],n.data=eZ(i.subarray(1)),n):e},e0=function(t){var e={tagType:eX[t[0]],dataSize:t[1]<<16|t[2]<<8|t[3],timestamp:t[7]<<24|t[4]<<16|t[5]<<8|t[6],streamID:t[8]<<16|t[9]<<8|t[10]};switch(t[0]){case 8:eQ(t.subarray(11),e);break;case 9:eJ(t.subarray(11),e)}return e},e1=function(t){var e=31&t[1];return e<<=8,e|=t[2]},e2=function(t){return!!(64&t[1])},e8=function(t){var e=0;return(48&t[3])>>>4>1&&(e+=t[4]+1),e},e4=function(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},e6=tq.handleRollover,e5={};e5.ts={parseType:function(t,e){var i=e1(t);return 0===i?"pat":i===e?"pmt":e?"pes":null},parsePat:function(t){var e=e2(t),i=4+e8(t);return e&&(i+=t[i]+1),(31&t[i+10])<<8|t[i+11]},parsePmt:function(t){var e,i,n={},a=e2(t),r=4+e8(t);if(a&&(r+=t[r]+1),1&t[r+5]){e=3+((15&t[r+1])<<8|t[r+2])-4,i=(15&t[r+10])<<8|t[r+11];for(var s=12+i;s<e;){var o=r+s;n[(31&t[o+1])<<8|t[o+2]]=t[o],s+=((15&t[o+3])<<8|t[o+4])+5}return n}},parsePayloadUnitStartIndicator:e2,parsePesType:function(t,e){switch(e[e1(t)]){case tF.H264_STREAM_TYPE:return"video";case tF.ADTS_STREAM_TYPE:return"audio";case tF.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(t){if(!e2(t))return null;var e=4+e8(t);if(e>=t.byteLength)return null;var i,n=null;return 192&(i=t[e+7])&&((n={}).pts=(14&t[e+9])<<27|(255&t[e+10])<<20|(254&t[e+11])<<12|(255&t[e+12])<<5|(254&t[e+13])>>>3,n.pts*=4,n.pts+=(6&t[e+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&t[e+14])<<27|(255&t[e+15])<<20|(254&t[e+16])<<12|(255&t[e+17])<<5|(254&t[e+18])>>>3,n.dts*=4,n.dts+=(6&t[e+18])>>>1)),n},videoPacketContainsKeyFrame:function(t){for(var e=4+e8(t),i=t.subarray(e),n=0,a=0,r=!1;a<i.byteLength-3;a++)if(1===i[a+2]){n=a+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}a+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===e4(31&i[a+3])&&(r=!0);do n++;while(1!==i[n]&&n<i.length);a=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===e4(31&i[a+3])&&(r=!0),a=n-2,n+=3;break;default:n+=3}return i=i.subarray(a),n-=a,a=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===e4(31&i[a+3])&&(r=!0),r}},e5.aac=t9;var e3=h.ONE_SECOND_IN_TS,e7=function(t,e){for(var i,n=0,a=188;a<t.byteLength;){if(71===t[n]&&71===t[a]){switch(i=t.subarray(n,a),e5.ts.parseType(i,e.pid)){case"pat":e.pid=e5.ts.parsePat(i);break;case"pmt":var r=e5.ts.parsePmt(i);e.table=e.table||{},Object.keys(r).forEach(function(t){e.table[t]=r[t]})}n+=188,a+=188;continue}n++,a++}},e9=function(t,e,i){for(var n,a,r,s,o=0,d=188,h=!1;d<=t.byteLength;){if(71===t[o]&&(71===t[d]||d===t.byteLength)){if(n=t.subarray(o,d),"pes"===e5.ts.parseType(n,e.pid)&&(a=e5.ts.parsePesType(n,e.table),r=e5.ts.parsePayloadUnitStartIndicator(n),"audio"===a&&r&&(s=e5.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),h=!0)),h)break;o+=188,d+=188;continue}o++,d++}for(o=(d=t.byteLength)-188,h=!1;o>=0;){if(71===t[o]&&(71===t[d]||d===t.byteLength)){if(n=t.subarray(o,d),"pes"===e5.ts.parseType(n,e.pid)&&(a=e5.ts.parsePesType(n,e.table),r=e5.ts.parsePayloadUnitStartIndicator(n),"audio"===a&&r&&(s=e5.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),h=!0)),h)break;o-=188,d-=188;continue}o--,d--}},it=function(t,e,i){for(var a,r,s,o,d,h,p,u=0,l=188,c=!1,f={data:[],size:0};l<t.byteLength;){if(71===t[u]&&71===t[l]){if(a=t.subarray(u,l),"pes"===e5.ts.parseType(a,e.pid)&&(r=e5.ts.parsePesType(a,e.table),s=e5.ts.parsePayloadUnitStartIndicator(a),"video"===r&&(s&&!c&&(o=e5.ts.parsePesTime(a))&&(o.type="video",i.video.push(o),c=!0),!i.firstKeyFrame))){if(s&&0!==f.size){for(d=new Uint8Array(f.size),h=0;f.data.length;)p=f.data.shift(),d.set(p,h),h+=p.byteLength;if(e5.ts.videoPacketContainsKeyFrame(d)){var m=e5.ts.parsePesTime(d);m?(i.firstKeyFrame=m,i.firstKeyFrame.type="video"):n.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}f.size=0}f.data.push(a),f.size+=a.byteLength}if(c&&i.firstKeyFrame)break;u+=188,l+=188;continue}u++,l++}for(u=(l=t.byteLength)-188,c=!1;u>=0;){if(71===t[u]&&71===t[l]){if(a=t.subarray(u,l),"pes"===e5.ts.parseType(a,e.pid)&&(r=e5.ts.parsePesType(a,e.table),s=e5.ts.parsePayloadUnitStartIndicator(a),"video"===r&&s&&(o=e5.ts.parsePesTime(a))&&(o.type="video",i.video.push(o),c=!0)),c)break;u-=188,l-=188;continue}u--,l--}},ie=function(t,e){if(t.audio&&t.audio.length){var i=e;(typeof i>"u"||isNaN(i))&&(i=t.audio[0].dts),t.audio.forEach(function(t){t.dts=e6(t.dts,i),t.pts=e6(t.pts,i),t.dtsTime=t.dts/e3,t.ptsTime=t.pts/e3})}if(t.video&&t.video.length){var n=e;if((typeof n>"u"||isNaN(n))&&(n=t.video[0].dts),t.video.forEach(function(t){t.dts=e6(t.dts,n),t.pts=e6(t.pts,n),t.dtsTime=t.dts/e3,t.ptsTime=t.pts/e3}),t.firstKeyFrame){var a=t.firstKeyFrame;a.dts=e6(a.dts,n),a.pts=e6(a.pts,n),a.dtsTime=a.dts/e3,a.ptsTime=a.pts/e3}}},ii=function(t){for(var e,i=!1,n=0,a=null,r=null,s=0,o=0;t.length-o>=3;){switch(e5.aac.parseType(t,o)){case"timed-metadata":if(t.length-o<10||(s=e5.aac.parseId3TagSize(t,o))>t.length){i=!0;break}null===r&&(e=t.subarray(o,o+s),r=e5.aac.parseAacTimestamp(e)),o+=s;break;case"audio":if(t.length-o<7||(s=e5.aac.parseAdtsSize(t,o))>t.length){i=!0;break}null===a&&(e=t.subarray(o,o+s),a=e5.aac.parseSampleRate(e)),n++,o+=s;break;default:o++}if(i)return null}if(null===a||null===r)return null;var d=e3/a;return{audio:[{type:"audio",dts:r,pts:r},{type:"audio",dts:r+1024*n*d,pts:r+1024*n*d}]}},ia=function(t){var e={pid:null,table:null},i={};for(var n in e7(t,e),e.table)if(e.table.hasOwnProperty(n))switch(e.table[n]){case tF.H264_STREAM_TYPE:i.video=[],it(t,e,i),0===i.video.length&&delete i.video;break;case tF.ADTS_STREAM_TYPE:i.audio=[],e9(t,e,i),0===i.audio.length&&delete i.audio}return i},ir={codecs:j,mp4:ew,flv:{tag:ec,Transmuxer:ek,getFlvHeader:function(t,e,i){var n,a,r,s=new Uint8Array(9),o=new DataView(s.buffer);return t=t||0,e=void 0===e||e,i=void 0===i||i,o.setUint8(0,70),o.setUint8(1,76),o.setUint8(2,86),o.setUint8(3,1),o.setUint8(4,(e?4:0)|(i?1:0)),o.setUint32(5,s.byteLength),t<=0?((a=new Uint8Array(s.byteLength+4)).set(s),a.set([0,0,0,0],s.byteLength)):((n=new ec(ec.METADATA_TAG)).pts=n.dts=0,n.writeMetaDataDouble("duration",t),r=n.finalize().length,(a=new Uint8Array(s.byteLength+r)).set(s),a.set(o.byteLength,r)),a}},mp2t:t2,partial:{Transmuxer:eV}};return ir.mp4.tools=eY,ir.flv.tools={inspectTag:e0,inspect:function(t){var e,i,n=[];for(i=13;i<t.byteLength;)e=(t[i+1]<<16|t[i+2]<<8|t[i+3])+11,n.push(e0(t.subarray(i,i+e))),i+=e+4;return n},textify:function(t){return JSON.stringify(t,null,2)}},ir.mp2t.tools={inspect:function(t,e){var i;return(i=e5.aac.isLikelyAacData(t)?ii(t):ia(t))&&(i.audio||i.video)?(ie(i,e),i):null},parseAudioPes_:e9},ir}(i(35276))}}]);